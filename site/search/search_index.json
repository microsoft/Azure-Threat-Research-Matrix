{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"Reconnaissance Initial Access Execution Privilege Escalation Persistence Credential Access Exfiltration Port Mapping Valid Credentials Virtual Machine Scripting Privileged Identity Management Role Account Manipulation Steal Managed Identity JsonWebToken SAS URI Generation IP Discovery Password Spraying Unmanaged Scripting Elevated Access Toggle  Account Creation Steal Service Principal Certificate File Share Mounting Public Accessible Resource Malicious Application Consent Managed Device Scripting Local Resource Hijack HTTP Trigger Service Principal Secret Reveal Replication Gather User Information Principal Impersonation Watcher Tasks Azure KeyVault Dumping Soft-Delete Recovery Gather Application Information Azure AD Application Scheduled Jobs Resource Secret Reveal Gather Role Information Network Security Group Modification Gather Resource Data External Entity Access Gather Victim Data Azure Policy How to Use <p>The top row designates the tactic being used and the rows below it are the specific techniques pertaining to that tactic. Clicking on a specific tactic will list the techniques specific to it. Clicking on a specific technique will bring you to the page on that technique and the details around it. </p> <p>You can also utilize the search bar at the top to recursively search for specific text. For example, to search for what techniques a certain action or permission has, just enter the action in the search bar and it will show all relevant techniques.     </p> <p>When viewing the page of a technique, specific examples of how to abuse the technique with different methods are shown. By clicking on the given command, it will bring you to the documentation around it.      </p> <p>Disclaimer</p> <p>The purpose of the Azure Threat Research Matrix (ATRM) is to educate readers on the potential of Azure-based tactics, techniques, and procedures (TTPs). It is not to teach how to weaponize or specifically abuse them. For this reason, some specific commands will be obfuscated or parts will be omitted to prevent abuse.  </p> <p>Feedback</p> <p>With the intent of ATRM being a collaborative effort with the community, feedback is greatly appreciated. Is there a new or missing technique? Is the formatting off-putting? Please let me know @haus3c.</p>"},{"location":"#acknowledgements","title":"Acknowledgements","text":""},{"location":"about/","title":"Purpose","text":"<p>The purpose of the Azure Threat Research Matrix (ATRM) is to conceptualize the known tactics, techniques, and procedures (TTP) that adversaries may use against the Azure platform. Inspired from MITRE ATT&amp;CK, ATRM is designed to give quick insight into a potential TTP that an adversary may be using in their attack campaign. While some tactics in ATT&amp;CK may pertain to Azure, the ATRM is meant to be specific within Azure AD and Azure Resources. The ATRM is created by Ryan Hausknecht (@haus3c) of the Microsoft EDG Raptor team.</p> <p>You can read the release blog post here: https://techcommunity.microsoft.com/t5/security-compliance-and-identity/introducing-the-azure-threat-research-matrix/ba-p/3584976</p>"},{"location":"acknowledgments/","title":"Acknowledgments","text":"<p>The Azure Threat Research Matrix is a collaborative effort with Microsoft and the greater information security industry. This project would not be possible without the following individuals and their contributions:</p> <ul> <li>Karl Fosaaen  </li> <li>Nestori Syynimaa  </li> <li>Ryan Cobb </li> <li>Roberto Rodriguez  </li> <li>Manuel Berrueta </li> <li>Jonny Johnson  </li> <li>Dor Edry  </li> <li>Ram Pliskin </li> <li>Nikhil Mittal  </li> <li>MITRE ATT&amp;CK - \u00a9 2021 The MITRE Corporation. This work is reproduced and distributed with the permission of The MITRE Corporation.</li> <li>AlertIQ</li> </ul>"},{"location":"CredentialAccess/CredentialAccess/","title":"Credential Access","text":"<p>The adversary is trying to steal account usernames, passwords, or access tokens. Credential access in Azure consists of stealing methods of authentication which includes passwords and tokens. Stealing these credentials can give adversaries a potential avenue of privilege escalation or persistence. </p> ID Name Description AZT601 Steal Managed Identity JsonWebToken An adverary may utilize the resource's functionality to obtain a JWT for the applied Managed Identity Service Principal account. .001 Virtual Machine IMDS Request By utilizing access to IMDS, an attacker can request a JWT for a Managed Identity on an Azure VM if they have access to execute commands on the system. .002 Azure Kubernetes Service IMDS Request By utilizing access to IMDS, an attacker can request a JWT for a Managed Identity on an AKS Cluster if they have access to execute commands on the system. .003 Logic Application JWT PUT Request If a Logic App is using a Managed Identity, an adversary can modify the logic to make an HTTP POST request to reveal the Managed Identity's JWT. .004 Function Application JWT GET Request If a Function App is using a Managed Identity, an adversary can modify the logic respond to an HTTP GET request to reveal the Managed Identity's JWT. .005 Automation Account Runbook If an Automation Account is using a Managed Identity, an adversary can create a Runbook to request the Managed Identity's JWT. AZT602 Steal Service Principal Certificate An Adversary may steal a Service Principal's certificate for authentication. .001 Automation Account RunAs Account If a Runbook is utilizing a 'RunAs' account, then an adversary may manipulate the Runbook to reveal the certificate the Service Principal is using for authentication. AZT603 Service Principal Secret Reveal An Adversary may reveal a service principal's secret in plain text. .001 Function App Settings If a Function App is using a service principal for authentication, an adversary may manipulate the function app logic to reveal the service principal's secret in plain text. AZT604 Azure KeyVault Dumping An adverary may access an Azure KeyVault in an attempt to view secrets, certificates, or keys. .001 Azure KeyVault Secret Dump By accessing an Azure KeyVault, an adversary may dump any or all secrets. .002 Azure KeyVault Certificate Dump By accessing an Azure KeyVault, an adversary may dump any or all certificates. .003 Azure KeyVault Key Dump By accessing an Azure KeyVault, an adversary may dump any or all keys. AZT605 Resource Secret Reveal .001 Storage Account Access Key Dumping By accessing a Storage Account, an adversary may dump access keys pertaining to the Storage Account, which will give them full access to the Storage Account. .002 Automation Account Credential Secret Dump By editing a Runbook, a credential configured in an Automation Account may be revealed .003 Resource Group Deployment History Secret Dump By accessing deployment history of a Resource Group, secrets used in the ARM template may be revealed."},{"location":"CredentialAccess/AZT601/AZT601-1/","title":"AZT601.1 - Steal Managed Identity JsonWebToken: Virtual Machine IMDS Request","text":"<p>By utilizing access to IMDS, an attacker can request a JWT for a Managed Identity on an Azure VM if they have access to execute commands on the system.</p> <p>Resource</p> <p>Virtual Machine</p> <p>Actions</p> <ul> <li>Microsoft.Compute/virtualMachines/write</li> <li>Microsoft.Compute/virtualMachines/extensions/*</li> </ul> <p>Examples</p> PowerShellAzure Portal <p><code>powershell.exe -c $a=Invoke-Restmethod -Uri 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01\"&amp;\"resource=https://management.azure.com/' -Method GET -Headers @{Metadata='true'} -UseBasicParsing;$a.access_token</code></p> <p></p> <p>Detections</p> <p>The detection will be based off of the Command Execution technique chosen. If using RDP, then no logs will be generated in Azure.  Since the command to retrieve the JWT requires local PowerShell execution, script block logging will reveal the request used to gather the token.</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/virtual-machines/windows/instance-metadata-service?tabs=windows</li> <li>https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-use-vm-token</li> </ul>"},{"location":"CredentialAccess/AZT601/AZT601-2/","title":"AZT601.2 - Steal Managed Identity JsonWebToken: Azure Kubernetes Service IMDS Request","text":"<p>By utilizing access to IMDS, an attacker can request a JWT for a Managed Identity on an AKS Cluster if they have access to execute commands on the system.</p> <p>Resource</p> <p>Azure Kubernetes Service</p> <p>Actions</p> <ul> <li>Microsoft.ContainerService/managedClusters/runcommand/action</li> <li>Microsoft.ContainerService/managedclusters/commandResults/read</li> </ul> <p>Examples</p> PythonPowerShellAzure Portal <p><code>curl 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&amp;resource=https%3A%2F%2Fmanagement.azure.com%2F' -H Metadata:true -s</code></p> <p><code>powershell.exe -c $a=Invoke-Restmethod -Uri 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01\"&amp;\"resource=https://management.azure.com/' -Method GET -Headers @{Metadata='true'} -UseBasicParsing;$a.access_token</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/aks/command-invoke</li> <li>https://docs.microsoft.com/en-us/azure/aks/use-managed-identity</li> </ul>"},{"location":"CredentialAccess/AZT601/AZT601-2/#detection-details","title":"Detection Details","text":"<p>Logs are only generated when running a command through az cli or Az PowerShell. Using <code>kubectl</code> will not generate logs.</p>"},{"location":"CredentialAccess/AZT601/AZT601-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource RunCommand Microsoft.ContainerService/managedClusters/runCommand/action Azure Activity Log"},{"location":"CredentialAccess/AZT601/AZT601-2/#queries","title":"Queries","text":"Log Analytics <pre><code>|where OperationNameValue==\"Microsoft.ContainerService/managedClusters/runCommand/action\" \n</code></pre>"},{"location":"CredentialAccess/AZT601/AZT601-3/","title":"AZT601.3 - Steal Managed Identity JsonWebToken: Logic Application JWT PUT Request","text":"<p>If a Logic App is using a Managed Identity, an adversary can modify the logic to make an HTTP POST request to reveal the Managed Identity's JWT.</p> <p>Resource</p> <p>Logic Application</p> <p>Actions</p> <ul> <li>Microsoft.Logic/workflows/write</li> <li>Microsoft.Logic/workflows/run/action</li> <li>Microsoft.Logic/operations/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Set-AzLogicApp</code></p> <p><code>az logicapp start</code> </p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}?api-version=2016-06-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/logic-apps/logic-apps-overview</p>"},{"location":"CredentialAccess/AZT601/AZT601-3/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Gets workflow recommend operation groups Microsoft.Logic/locations/workflows/recommendOperationGroups/action Azure Activity Log Resource List Trigger Callback URL Microsoft.Logic/workflows/triggers/listCallbackUrl/action Azure Activity Log Resource Add or Update Connection Microsoft.Web/connections/write Azure Activity Log"},{"location":"CredentialAccess/AZT601/AZT601-3/#queries","title":"Queries","text":"Log Analytics <pre><code>|where OperationNameValue==\"Microsoft.Logic/locations/workflows/recommendOperationGroups/action\" or OperationNameValue==\"Microsoft.Logic/workflows/triggers/listCallbackUrl/action\"orOperationNameValue==\"Microsoft.Web/connections/write\"\n</code></pre>"},{"location":"CredentialAccess/AZT601/AZT601-4/","title":"AZT601.4 - Steal Managed Identity JsonWebToken: Function Application JWT GET Request","text":"<p>If a Function App is using a Managed Identity, an adversary can modify the logic respond to an HTTP GET request to reveal the Managed Identity's JWT.</p> <p>Resource</p> <p>Function App</p> <p>Actions</p> <ul> <li>Microsoft.Web/sites/Write</li> <li>Microsoft.web/sites/functions/action</li> <li>Microsoft.web/sites/functions/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure Portal <p><code>Update-AzFunctionApp</code></p> <p><code>az functionapp update</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview</p>"},{"location":"CredentialAccess/AZT601/AZT601-4/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Active Directory Update website Microsoft.Web/sites/write AzureAD Audit Logs Azure Active Directory Start Web App Microsoft.Web/sites/start/action AzureAD Audit Logs"},{"location":"CredentialAccess/AZT601/AZT601-4/#queries","title":"Queries","text":"Log Analytics <p><code>AuditLogs| where ActivityDisplayName == \"Update website\" or ActivityDisplayName == \"Start Web App\"</code></p>"},{"location":"CredentialAccess/AZT601/AZT601-5/","title":"AZT601.4 - Steal Managed Identity JsonWebToken: Automation Account Runbook","text":"<p>If an Automation Account is using a Managed Identity, an adversary can create a Runbook to request the Managed Identity's JWT. </p> <p>Resource</p> <p>Automation Account</p> <p>Actions</p> <ul> <li>Microsoft.Automation/automationAccounts/runbooks/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>New-AzAutomationRunbook</code></p> <p><code>az automation runbook create</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/runbooks/{runbookName}?api-version=2019-06-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/automation/automation-runbook-execution</li> <li>https://posts.specterops.io/managed-identity-attack-paths-part-1-automation-accounts-82667d17187a</li> </ul>"},{"location":"CredentialAccess/AZT601/AZT601-5/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create an Azure Automation job Microsoft.Automation/automationAccounts/jobs/write Azure Activity Log Resource Publish an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/publish/action Azure Activity Log Resource Write an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/draft/write Azure Activity Log Resource Create or Update an Azure Automation Runbook Microsoft.Automation/automationAccounts/runbooks/write Azure Activity Log"},{"location":"CredentialAccess/AZT601/AZT601-5/#queries","title":"Queries","text":"Log Analytics <pre><code> |where OperationNameValue==\"Microsoft.Automation/automationAccounts/jobs/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/publish/action\"\n or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/draft/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/write\"\n</code></pre>"},{"location":"CredentialAccess/AZT601/AZT601/","title":"AZT601 - Steal Managed Identity JsonWebToken","text":"<p>An adverary may utilize the resource's functionality to obtain a JWT for the applied Managed Identity Service Principal account.</p> ID Name Description Action Resources AZT601.1 Virtual Machine IMDS Request By utilizing access to IMDS, an attacker can request a JWT for a Managed Identity on an Azure VM if they have access to execute commands on the system. Microsoft.Compute/virtualMachines/write Virtual Machine Microsoft.Compute/virtualMachines/extensions/* AZT601.2 Azure Kubernetes Service IMDS Request By utilizing access to IMDS, an attacker can request a JWT for a Managed Identity on an AKS Cluster if they have access to execute commands on the system. Microsoft.ContainerService/managedClusters/runcommand/action Azure Kubernetes Service Microsoft.ContainerService/managedclusters/commandResults/read AZT601.3 Logic Application JWT PUT Request If a Logic App is using a Managed Identity, an adversary can modify the logic to make an HTTP POST request to reveal the Managed Identity's JWT. Microsoft.Logic/workflows/write Logic Application Microsoft.Logic/workflows/run/action Microsoft.Logic/operations/read AZT601.4 Function Application JWT GET Request If a Function App is using a Managed Identity, an adversary can modify the logic respond to an HTTP GET request to reveal the Managed Identity's JWT. Microsoft.Web/sites/Write Function App microsoft.web/sites/functions/action microsoft.web/sites/functions/write AZT601.5 Automation Account Runbook If an Automation Account is using a Managed Identity, an adversary can create a Runbook to request the Managed Identity's JWT. Microsoft.Automation/automationAccounts/runbooks/write Automation Account"},{"location":"CredentialAccess/AZT602/AZT602-1/","title":"AZT602.1 - Steal Service Principal Certificate: Automation Account RunAs Account","text":"<p>If a Runbook is utilizing a 'RunAs' account, then an adversary may manipulate the Runbook to reveal the certificate the Service Principal is using for authentication.</p> <p>Resource</p> <p>Automation Account</p> <p>Actions</p> <ul> <li>Microsoft.Automation/automationAccounts/runbooks/*</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <ul> <li><code>New-AzAutomationRunbook</code></li> <li><code>Set-AzAutomationRunbook</code></li> </ul> <p><code>az automation runbook</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/runbooks/{runbookName}?api-version=2019-06-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/automation/automation-runbook-execution</p>"},{"location":"CredentialAccess/AZT602/AZT602-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create an Azure Automation job Microsoft.Automation/automationAccounts/jobs/write Azure Activity Log Resource Publish an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/publish/action Azure Activity Log Resource Write an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/draft/write Azure Activity Log Resource Create or Update an Azure Automation Runbook Microsoft.Automation/automationAccounts/runbooks/write Azure Activity Log"},{"location":"CredentialAccess/AZT602/AZT602-1/#queries","title":"Queries","text":"Log Analytics <pre><code> |where OperationNameValue==\"Microsoft.Automation/automationAccounts/jobs/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/publish/action\"\n or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/draft/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/write\"\n</code></pre>"},{"location":"CredentialAccess/AZT603/AZT603-1/","title":"AZT603.1 - Service Principal Secret Reveal: Function App Settings","text":"<p>If a Function App is using a service principal for authentication, an adversary may manipulate the function app logic to reveal the service principal's secret in plain text.</p> <p>Resource</p> <p>Function App</p> <p>Actions</p> <ul> <li>Microsoft.web/sites/functions/read</li> <li>Microsoft.Web/sites/read</li> <li>Microsoft.Web/sites/config/list/action</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST API <p><code>Get-AzFunctionAppSetting</code></p> <p><code>az functionapp config appsettings</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Web/sites/{name}/config/appsettings?api-version=2021-02-01</code> </p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/automation/automation-runbook-execution</p>"},{"location":"CredentialAccess/AZT603/AZT603-1/#detection-details","title":"Detection Details","text":"<p>No logs are generated when retrieving the settings of a function app.</p>"},{"location":"CredentialAccess/AZT604/AZT604-1/","title":"AZT604.1 - Azure Key Vault Dumping: Azure Key Vault Secret Dump","text":"<p>By accessing an Azure Key Vault, an adversary may dump any or all secrets.</p> <p>Resource</p> <p>Azure Key Vault</p> <p>Actions</p> <ul> <li>Microsoft.KeyVault/vaults/secrets/getSecret/action</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Get-AzKeyVaultSecret</code></p> <p><code>az keyvault secret</code></p> <p><code>GET {vaultBaseUrl}/secrets/{secret-name}/{secret-version}?api-version=7.3</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/key-vault/general/logging?WT.mc_id=Portal-fx&amp;tabs=Vault</p>"},{"location":"CredentialAccess/AZT604/AZT604-1/#detection-details","title":"Detection Details","text":"<p>By default, logging is not enabled on Key Vaults, meaning whenever a secret/key/certificate is accessed, it will not be logged unless Key Vault logging is turned on. </p>"},{"location":"CredentialAccess/AZT604/AZT604-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Diagnostics SecretGet N/A Log Analytics"},{"location":"CredentialAccess/AZT604/AZT604-1/#queries","title":"Queries","text":"Platform Query Log Analytics <code>AzureDiagnostics | where ResourceProvider ==\"MICROSOFT.KEYVAULT\" and OperationName == \"SecretGet\"</code>"},{"location":"CredentialAccess/AZT604/AZT604-2/","title":"AZT604.2 - Azure Key Vault Dumping: Azure Key Vault Certificate Dump","text":"<p>By accessing an Azure Key Vault, an adversary may dump any or all certificates.</p> <p>Resource</p> <p>Azure Key Vault</p> <p>Actions</p> <ul> <li>Microsoft.KeyVault/vaults/secrets/getSecret/action</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Get-AzKeyVaultCertificate</code></p> <p><code>az keyvault certificate</code></p> <p><code>GET {vaultBaseUrl}/certificates/{certificate-name}/{certificate-version}?api-version=7.3</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/key-vault/general/logging?WT.mc_id=Portal-fx&amp;tabs=Vault</p>"},{"location":"CredentialAccess/AZT604/AZT604-2/#detection-details","title":"Detection Details","text":"<p>By default, logging is not enabled on Key Vaults, meaning whenever a secret/key/certificate is accessed, it will not be logged unless Key Vault logging is turned on. </p>"},{"location":"CredentialAccess/AZT604/AZT604-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Diagnostics CertificateList N/A Log Analytics Azure Diagnostics SecretGet N/A Log Analytics"},{"location":"CredentialAccess/AZT604/AZT604-2/#queries","title":"Queries","text":"Platform Query Log Analytics <code>AzureDiagnostics | where ResourceProvider ==\"MICROSOFT.KEYVAULT\" and OperationName == \"CertificateList\" or OperationName == \"SecretGet\"</code>"},{"location":"CredentialAccess/AZT604/AZT604-3/","title":"AZT604.3 - Azure Key Vault Dumping: Azure Key Vault Key Dump","text":"<p>By accessing an Azure Key Vault, an adversary may dump any or all public keys. Note that Private keys cannot be retrieved.</p> <p>Resource</p> <p>Azure Key Vault</p> <p>Actions</p> <ul> <li>Microsoft.KeyVault/vaults/keys/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Get-AzKeyVaultKey</code></p> <p><code>az keyvault key</code></p> <p><code>GET {vaultBaseUrl}/keys/{key-name}/{key-version}?api-version=7.3</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/key-vault/general/logging?WT.mc_id=Portal-fx&amp;tabs=Vault</p>"},{"location":"CredentialAccess/AZT604/AZT604-3/#detection-details","title":"Detection Details","text":"<p>By default, logging is not enabled on Key Vaults, meaning whenever a secret/key/certificate is accessed, it will not be logged unless Key Vault logging is turned on. </p>"},{"location":"CredentialAccess/AZT604/AZT604-3/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Diagnostics KeyList N/A Log Analytics"},{"location":"CredentialAccess/AZT604/AZT604-3/#queries","title":"Queries","text":"Platform Query Log Analytics <code>AzureDiagnostics | where ResourceProvider ==\"MICROSOFT.KEYVAULT\" and OperationName == \"KeyList\"</code>"},{"location":"CredentialAccess/AZT604/AZT604/","title":"AZT604 - Azure KeyVault Dumping","text":"<p>An adverary may access an Azure KeyVault in an attempt to view secrets, certificates, or keys.</p> ID Name Description Action Resources AZT604.1 Azure KeyVault Secret Dump By accessing an Azure KeyVault, an adversary may dump any or all secrets. Microsoft.KeyVault/vaults/secrets/getSecret/action Azure KeyVault AZT604.2 Azure KeyVault Certificate Dump By accessing an Azure KeyVault, an adversary may dump any or all certificates. Microsoft.KeyVault/vaults/certificates/read Azure KeyVault AZT604.3 Azure KeyVault Key Dump By accessing an Azure KeyVault, an adversary may dump any or all keys. Microsoft.KeyVault/vaults/keys/read Azure KeyVault"},{"location":"CredentialAccess/AZT605/AZT605-1/","title":"AZT605.1 - Resource Secret Reveal: Storage Account Access Key Dumping","text":"<p>By accessing a Storage Account, an adversary may dump access keys pertaining to the Storage Account, which will give them full access to the Storage Account.</p> <p>Resource</p> <p>Azure Storage Account</p> <p>Actions</p> <ul> <li>Microsoft.Storage/storageAccounts/listkeys/action</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Get-AzStorageAccountKey</code></p> <p><code>az storage account keys</code></p> <p><code>https://{myaccount}.blob.core.windows.net/?restype=service&amp;comp=userdelegationkey</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage?tabs=azure-portal</p>"},{"location":"CredentialAccess/AZT605/AZT605-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource TBD TBD Azure Activity Log"},{"location":"CredentialAccess/AZT605/AZT605-1/#queries","title":"Queries","text":"Log Analytics <pre><code>|where OperationNameValue==\"TBD\"\n</code></pre>"},{"location":"CredentialAccess/AZT605/AZT605-2/","title":"AZT605.1 - Resource Secret Reveal: Automation Account Credential Secret Dump","text":"<p>By editing a Runbook, a credential configured in an Automation Account may be revealed</p> <p>Resource</p> <p>Automation Account</p> <p>Actions</p> <ul> <li>Microsoft.Automation/automationAccounts/runbooks/*  </li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <ul> <li><code>New-AzAutomationRunbook</code></li> <li><code>Set-AzAutomationRunbook</code></li> </ul> <p><code>az automation runbook</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/runbooks/{runbookName}?api-version=2019-06-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage?tabs=azure-portal</p>"},{"location":"CredentialAccess/AZT605/AZT605-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create an Azure Automation job Microsoft.Automation/automationAccounts/jobs/write Azure Activity Log Resource Publish an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/publish/action Azure Activity Log Resource Write an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/draft/write Azure Activity Log Resource Create or Update an Azure Automation Runbook Microsoft.Automation/automationAccounts/runbooks/write Azure Activity Log"},{"location":"CredentialAccess/AZT605/AZT605-2/#queries","title":"Queries","text":"Log Analytics <pre><code> |where OperationNameValue==\"Microsoft.Automation/automationAccounts/jobs/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/publish/action\"\n or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/draft/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/write\"\n</code></pre>"},{"location":"CredentialAccess/AZT605/AZT605-3/","title":"AZT605.3 - Resource Secret Reveal: Resource Group Deployment History Secret Dump","text":"<p>By accessing deployment history of a Resource Group, secrets used in the ARM template may be revealed.</p> <p>Resource</p> <p>Resource Group</p> <p>Actions</p> <ul> <li>Microsoft.Resources/deployments/read</li> <li>Microsoft.Resources/subscriptions/resourceGroups/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure Portal <p><code>Get-AzResourceGroupDeployment</code></p> <ul> <li><code>az deployment group list</code></li> <li><code>az deployment group export</code></li> </ul> <p>605.3.1 605.3.2</p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/deployment-history?tabs=azure-portal</p>"},{"location":"CredentialAccess/AZT605/AZT605-3/#detection-details","title":"Detection Details","text":"<p>When a template is used, the parameters from the template are reflected on the 'Input' page when viewing the deployment detail in the Azure portal. The parameter key value's are shown unless the key 'SecureString' is used. If 'SecureString' is not used, then the value will show in the deployment input details. </p>"},{"location":"CredentialAccess/AZT605/AZT605-3/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource N/A N/A Azure Activity Log"},{"location":"CredentialAccess/AZT605/AZT605/","title":"AZT605 - Resource Secret Reveal","text":"<p>An adverary may access an Azure KeyVault in an attempt to view secrets, certificates, or keys.</p> ID Name Description Action Resources .001 Storage Account Access Key Dumping By accessing a Storage Account, an adversary may dump access keys pertaining to the Storage Account, which will give them full access to the Storage Account. Microsoft.Storage/storageAccounts/listkeys/action Storage Account .002 Automation Account Credential Secret Dump By editing a Runbook, a credential configured in an Automation Account may be revealed Microsoft.Automation/automationAccounts/runbooks/* Automation Account .003 Resource Group Deployment History Secret Dump By accessing deployment history of a Resource Group, secrets used in the ARM template may be revealed. Microsoft.Resources/deployments/read Resource Group"},{"location":"Execution/Execution/","title":"Execution","text":"<p>The adversary is trying to run malicious code.</p> <p>Execution in Azure consists of techniques that run code either through a managed device, virtual machine, or on an unmanaged host. Execution specifically is attributable to when malicious code is ran in an attempt to gain access to a host/device.</p> ID Name Description AZT301 Virtual Machine Scripting Adversaries may abuse access to virtual machines by executing a script through various methods in order to gain access to the Virtual Machine. .001 RunCommand By utilizing the 'RunCommand' feature on a Virtual Machine, an attacker can pass PowerShell commands to the VM as SYSTEM. .002 CustomScriptExtension By utilizing the 'CustomScriptExtension' extension on a Virtual Machine, an attacker can pass PowerShell commands to the VM as SYSTEM. .003 Desired State Configuration By utilizing the 'Desired State Configuration extension' extension on a Virtual Machine, an attacker can pass PowerShell commands to the VM as SYSTEM. .004 Compute Gallery Application By utilizing Compute Gallery Applications, an attacker can pass MS-DOS or PowerShell commands to the VM as SYSTEM. .005 AKS Command Invoke By utilizing 'command invoke' on an Azure Kubernetes Service (AKS) cluster, an attacker can pass commands to the cluster's VM as SYSTEM .006 Vmss Run Command By utilizing the 'RunCommand' feature on a virtual machine scale set (vmss), an attacker can execute a command on an instance of a VM as SYSTEM. .007 Serial Console By utilizing the serial console feature on an Azure Virtual Machine, an adversary can pass arbitrary commands. AZT302 Serverless Scripting Adversaries may abuse access to serverless resources that are able to execute PowerShell or Python scripts on an Azure Resource. .001 Automation Account Runbook Hybrid Worker Group By utilizing an Automation Account configured with a Hybrid Worker Group, an attacker can execute Azure commands on any Azure VM within that Hybrid Worker Group. .002 Automation Account Runbook RunAs Account By utilizing an Automation Account configured with a RunAs account, an attacker can execute commands on an Azure VM via RunCommand if that service principal has the correct role and privileges. .003 Automation Account Runbook Managed Identity By utilizing an Automation Account configured with a Managed Identity, an attacker can execute commands on an Azure VM via RunCommand if that service principal has the correct role and privileges. .004 Function Application By utilizing a Function Application, an attacker can execute Azure operations on a given resource. AZT303 Managed Device Scripting Adversaries may abuse access to any managed devices in AzureAD by executing PowerShell or Python scripts on them."},{"location":"Execution/AZT301/AZT301-1/","title":"AZT301.1 - Virtual Machine Scripting: RunCommand","text":"<p>By utilizing the 'RunCommand' feature on a Virtual Machine, an attacker can pass:</p> <ul> <li> <p>Windows: PowerShell commands to the VM as SYSTEM.</p> </li> <li> <p>Linux: Shell commands to the VM as root.</p> </li> </ul> <p>Resource<ul> <li>Virtual Machine</li> </ul> </p> <p>Actions<ul> <li>Microsoft.Compute/virtualMachines/runCommand/action</li> <li>Microsoft.Compute/locations/runCommands/read</li> </ul> </p> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Invoke-AzVMRunCommand</code></p> <p><code>az vm run-command</code></p> <p><code>POST https://management.azure.com/subscriptions/{sub id}/resourceGroups/{rg name}/providers/Microsoft.Compute/virtualMachines/{vm name}/runCommand?api-version=2022-03-01</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/virtual-machines/windows/run-command</li> <li>https://docs.microsoft.com/en-us/azure/virtual-machines/linux/run-command</li> <li>https://stratus-red-team.cloud/attack-techniques/azure/azure.execution.vm-run-command/</li> </ul>"},{"location":"Execution/AZT301/AZT301-1/#detection-details","title":"Detection Details","text":"<ul> <li>Windows: The commands are stored as .PS1 files. </li> <li>Linux: The commands are stored as script.sh files. </li> </ul>"},{"location":"Execution/AZT301/AZT301-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Run Command on Virtual Machine Microsoft.Compute/virtualMachines/runCommand/action Azure Activity Log On-Resource File (Windows) File Creation N/A C:\\Packages\\Plugins\\Microsoft.CPlat.Core.RunCommandWindows\\1.1.11\\Downloads On-Resource File (Windows) File Creation N/A C:\\Packages\\Plugins\\Microsoft.CPlat.Core.RunCommandWindows\\1.1.11\\Status On-Resource File (Linux) File Creation N/A /var/lib/waagent/run-command/download/ On-Resource File (Linux) File Creation N/A /var/lib/waagent/Microsoft.CPlat.Core.RunCommandLinux-1.0.3/status/"},{"location":"Execution/AZT301/AZT301-1/#queries","title":"Queries","text":"Log Analytics <pre><code>   |where OperationNameValue==\"Microsoft.Compute/virtualMachines/runCommand/action\"\n</code></pre>"},{"location":"Execution/AZT301/AZT301-2/","title":"AZT301.2 - Virtual Machine Scripting: CustomScriptExtension","text":"<p>By utilizing the 'CustomScriptExtension' extension on a Virtual Machine, an attacker can pass PowerShell commands to the VM as SYSTEM.</p> <p>Resource</p> <ul> <li>Virtual Machine</li> <li>Virtual Machine Scale Sets</li> <li>Azure ARC </li> </ul> <p>Actions</p> <ul> <li>Microsoft.Compute/virtualMachines/extensions/*</li> <li>Microsoft.Compute/virtualMachines/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Set-AzVMCustomScriptExtension</code></p> <p><code>az vm extension set</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/{rg name}/providers/Microsoft.Compute/virtualMachines/{vm name]/extensions/CustomScriptExtension?api-version=2022-03-01</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/custom-script-windows</li> <li>https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/custom-script-linux</li> <li>https://stratus-red-team.cloud/attack-techniques/azure/azure.execution.vm-custom-script-extension/</li> </ul>"},{"location":"Execution/AZT301/AZT301-2/#detection-details","title":"Detection Details","text":"<p>The commands are stored as .PS1 files and deleted after running.</p>"},{"location":"Execution/AZT301/AZT301-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create or Update Virtual Machine Extension Microsoft.Compute/virtualMachines/extensions/write Azure Activity Log On-Resource File File Creation N/A C:\\Packages\\Plugins\\Microsoft.Compute.CustomScriptExtension\\1.9.5\\Downloads On-Resource File File Creation N/A C:\\Packages\\Plugins\\Microsoft.Compute.CustomScriptExtension\\1.9.5\\Status"},{"location":"Execution/AZT301/AZT301-2/#queries","title":"Queries","text":"Log Analytics <pre><code>   |where OperationNameValue==\"Microsoft.Compute/virtualMachines/extensions/write\"\n</code></pre>"},{"location":"Execution/AZT301/AZT301-3/","title":"AZT301.3 - Virtual Machine Scripting: Desired State Configuration","text":"<p>By utilizing the 'Desired State Configuration extension' extension on a Virtual Machine, an attacker can pass PowerShell commands to the VM as SYSTEM.</p> <p>Resource</p> <ul> <li>Virtual Machine</li> <li>Virtual Machine Scale Sets</li> </ul> <p>Actions</p> <ul> <li>Microsoft.Compute/virtualMachines/extensions/*</li> <li>Microsoft.Compute/virtualMachines/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Set-AzVMDscExtension</code></p> <p><code>az vm extension set</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/{rg name}/providers/Microsoft.Compute/virtualMachines/{vm name]/extensions/DSC?api-version=2022-03-01</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/dsc-overview</p>"},{"location":"Execution/AZT301/AZT301-3/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create or Update Virtual Machine Extension Microsoft.Compute/virtualMachines/extensions/write Azure Activity Log On-Resource File File Creation N/A C:\\Packages\\Plugins\\Microsoft.Powershell.DSC\\2.83.2.0\\Status"},{"location":"Execution/AZT301/AZT301-3/#queries","title":"Queries","text":"Log Analytics <pre><code>   |where OperationNameValue==\"Microsoft.Compute/virtualMachines/extensions/write\"\n</code></pre>"},{"location":"Execution/AZT301/AZT301-4/","title":"AZT301.4 - Virtual Machine Scripting: Compute Gallery Application","text":"<p>By utilizing Compute Gallery Applications, an attacker can pass MS-DOS or PowerShell commands to the VM as SYSTEM.</p> <p>Actions</p> <ul> <li>Microsoft.Compute/virtualMachines/write</li> <li>Microsoft.Compute/galleries/write</li> <li>Microsoft.Compute/galleries/applications/write</li> <li>Microsoft.Compute/galleries/applications/versions/write</li> </ul> <p>Resource</p> <p>Virtual Machine</p> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <ul> <li> <p><code>New-AzGalleryApplication</code></p> </li> <li> <p><code>New-AzGalleryApplicationVersion</code></p> </li> </ul> <ul> <li><code>az sig gallery-application create</code></li> <li><code>az sig image-version create</code></li> </ul> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Compute/galleries/{galleryName}/applications/{galleryApplicationName}?api-version=2021-10-01</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/virtual-machines/vm-applications</p>"},{"location":"Execution/AZT301/AZT301-4/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create or Update Gallery Application Version Microsoft.Compute/galleries/applications/versions/write Azure Activity Log Resource Create or Update Gallery Application Microsoft.Compute/galleries/applications/write Azure Portal Resource Create or Update Gallery Application Version Microsoft.Compute/galleries/applications/versions/write Azure Activity Log Resource Create or Update Gallery Application Version Microsoft.Compute/galleries/applications/versions/write Azure Activity Log On-Resource File File Creation N/A C:\\Packages\\Plugins\\Microsoft.Powershell.DSC\\2.83.2.0\\Status"},{"location":"Execution/AZT301/AZT301-4/#queries","title":"Queries","text":"Log Analytics <pre><code> |where OperationNameValue==\"Microsoft.Compute/galleries/applications/versions/write\" \n</code></pre>"},{"location":"Execution/AZT301/AZT301-5/","title":"AZT301.5 - Virtual Machine Scripting: AKS Command Invoke","text":"<p>By utilizing 'command invoke' on an Azure Kubernetes Service (AKS) cluster, an attacker can pass commands to the cluster's VM as SYSTEM</p> <p>Resource</p> <p>Azure Kubernetes Service</p> <p>Actions</p> <ul> <li>Microsoft.ContainerService/managedClusters/runcommand/action</li> <li>Microsoft.ContainerService/managedclusters/commandResults/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Invoke-AzAksRunCommand</code></p> <p><code>az aks command invoke</code></p> <p><code>POST https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.ContainerService/managedClusters/{resourceName}/runCommand?api-version=2022-04-01</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/aks/command-invoke</p>"},{"location":"Execution/AZT301/AZT301-5/#detection-details","title":"Detection Details","text":"<p>Logs are only generated when running a command through az cli or Az PowerShell. Using <code>kubectl</code> will not generate logs.</p>"},{"location":"Execution/AZT301/AZT301-5/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource RunCommand Microsoft.ContainerService/managedClusters/runCommand/action Azure Activity Log <p>##  Queries</p> Log Analytics <pre><code>  |where OperationNameValue==\"Microsoft.ContainerService/managedClusters/runCommand/action\"\n</code></pre>"},{"location":"Execution/AZT301/AZT301-6/","title":"AZT301.6 - Virtual Machine Scripting: Vmss Run Command","text":"<p>By utilizing the 'RunCommand' feature on a virtual machine scale set (Vmss), an attacker can execute a command on an instance or instances of VMs as:</p> <ul> <li> <p>Windows: PowerShell commands to the VM as SYSTEM.</p> </li> <li> <p>Linux: Shell commands to the VM as root.</p> </li> </ul> <p>Resource<ul> <li>Virtual Machine Scale Sets</li> </ul> </p> <p>Actions<ul> <li>Microsoft.Compute/virtualMachineScaleSets/virtualMachines/runCommand/action</li> </ul> </p> <p>Examples</p> Az PowerShellAzure CLIAzure REST API <p><code>Invoke-AzVmssVMRunCommand</code></p> <p><code>az vmss run-command</code></p> <p><code>PATCH https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Compute/virtualMachineScaleSets/{vmScaleSetName}/virtualMachines/{instanceId}/runCommands/{runCommandName}?api-version=2022-03-01</code></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/virtual-machines/windows/run-command</li> <li>https://docs.microsoft.com/en-us/azure/virtual-machines/linux/run-command</li> </ul>"},{"location":"Execution/AZT301/AZT301-6/#detection-details","title":"Detection Details","text":"<ul> <li>Windows: The commands are stored as .PS1 files. </li> <li>Linux: The commands are stored as script.sh files. </li> </ul>"},{"location":"Execution/AZT301/AZT301-6/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Run Command on a Virtual Machine instance in a Virtual Machine Scale Set Microsoft.Compute/virtualMachineScaleSets/virtualMachines/runCommand/action Azure Activity Log On-Resource File (Windows) File Creation N/A C:\\Packages\\Plugins\\Microsoft.CPlat.Core.RunCommandWindows\\1.1.11\\Downloads On-Resource File (Windows) File Creation N/A C:\\Packages\\Plugins\\Microsoft.CPlat.Core.RunCommandWindows\\1.1.11\\Status On-Resource File (Linux) File Creation N/A /var/lib/waagent/run-command/download/ On-Resource File (Linux) File Creation N/A /var/lib/waagent/Microsoft.CPlat.Core.RunCommandLinux-1.0.3/status/"},{"location":"Execution/AZT301/AZT301-6/#queries","title":"Queries","text":"Log Analytics <pre><code>   |where OperationNameValue==\"Microsoft.Compute/virtualMachineScaleSets/virtualMachines/runCommand/action\"\n</code></pre>"},{"location":"Execution/AZT301/AZT301-7/","title":"AZT301.1 - Virtual Machine Scripting: Serial Console","text":"<p>By utilizing the serial console feature on an Azure Virtual Machine, an adversary can pass arbitrary commands.</p> <p>Resource<p>Virtual Machine</p> </p> <p>Actions<p>Microsoft.SerialConsole/serialPorts/connect/action</p> </p> <p>Examples</p> Azure Portal <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/troubleshoot/azure/virtual-machines/serial-console-overview</li> </ul>"},{"location":"Execution/AZT301/AZT301-7/#detection-details","title":"Detection Details","text":"<p>Commands are passed directly via COM1 port to the virtual machine. Logging requires boot diagnostics to be enabled.</p>"},{"location":"Execution/AZT301/AZT301-7/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource N/A N/A Boot Diagnostics"},{"location":"Execution/AZT301/AZT301/","title":"AZT301 - Virtual Machine Scripting","text":"<p>Adversaries may abuse access to virtual machines by executing a script through various methods in order to gain access to the Virtual Machine.</p> ID Name Description Action Resources AZT301.1 RunCommand By utilizing the 'RunCommand' feature on a Virtual Machine, an attacker can pass PowerShell commands to the VM as SYSTEM. Microsoft.Compute/virtualMachines/runCommand/action Virtual Machine Microsoft.Compute/locations/runCommands/read AZT301.2 CustomScriptExtension By utilizing the 'CustomScriptExtension' extension on a Virtual Machine, an attacker can pass PowerShell commands to the VM as SYSTEM. Microsoft.Compute/virtualMachines/extensions/* Virtual Machine Microsoft.Compute/virtualMachines/write AZT301.3 Desired State Configuration By utilizing the 'Desired State Configuration extension' extension on a Virtual Machine, an attacker can pass PowerShell commands to the VM as SYSTEM. Microsoft.Compute/virtualMachines/extensions/* Virtual Machine Microsoft.Compute/virtualMachines/write AZT301.4 Compute Gallery Application By utilizing Compute Gallery Applications, an attacker can pass MS-DOS or PowerShell commands to the VM as SYSTEM. Microsoft.Compute/virtualMachines/write Virtual Machine, Compute Gallery Microsoft.Compute/galleries/write Microsoft.Compute/galleries/applications/write Microsoft.Compute/galleries/applications/versions/write AZT301.5 AKS Command Invoke By utilizing 'command invoke' on an Azure Kubernetes Service (AKS) cluster, an attacker can pass commands to the cluster's VM as SYSTEM Microsoft.ContainerService/managedClusters/runcommand/action Azure Kubernetes Services Microsoft.ContainerService/managedclusters/commandResults/read AZT301.6 Vmss Run Command By utilizing the 'RunCommand' feature on a virtual machine scale set (vmss), an attacker can execute a command on an instance of a VM as SYSTEM Microsoft.Compute/virtualMachineScaleSets/virtualMachines/runCommand/action Virtual Machine Scale Sets AZT301.7 Serial Console By utilizing the serial console feature on an Azure Virtual Machine, an adversary can pass arbitrary commands. Microsoft.SerialConsole/serialPorts/connect/action Virtual Machine"},{"location":"Execution/AZT302/AZT302-1/","title":"AZT302.1 - Unmanaged Scripting: Automation Account Hybrid Worker Group","text":"<p>By utilizing an Automation Account configured with a Hybrid Worker Group, an attacker can execute Azure commands on any Azure VM within that Hybrid Worker Group.</p> <p>Resource</p> <p>Automation Account</p> <p>Actions</p> <ul> <li>Microsoft.Automation/automationAccounts/runbooks/draft/write</li> <li>Microsoft.Automation/automationAccounts/runbooks/write</li> <li>Microsoft.Automation/automationAccounts/runbooks/publish/action</li> <li>Microsoft.Automation/automationAccounts/jobs/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>New-AzAutomationRunbook</code></p> <p><code>az automation runbook create</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/runbooks/{runbookName}?api-version=2019-06-01</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/automation/automation-runbook-execution</p>"},{"location":"Execution/AZT302/AZT302-1/#detection-details","title":"Detection Details","text":"<p>It is recommended to turn on verbose logging for Automation Accounts.</p>"},{"location":"Execution/AZT302/AZT302-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create an Azure Automation job Microsoft.Automation/automationAccounts/jobs/write Azure Activity Log Resource Publish an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/publish/action Azure Activity Log Resource Write an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/draft/write Azure Activity Log Resource Create or Update an Azure Automation Runbook Microsoft.Automation/automationAccounts/runbooks/write Azure Activity Log On Target Resource File (Windows) File Creation N/A C:\\Packages\\Plugins\\Microsoft.Azure.Automation.HybridWorker.HybridWorkerForWindows\\0.1.0.18\\Status"},{"location":"Execution/AZT302/AZT302-1/#queries","title":"Queries","text":"Log Analytics <pre><code> |where OperationNameValue==\"Microsoft.Automation/automationAccounts/jobs/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/publish/action\"\n or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/draft/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/write\"\n</code></pre>"},{"location":"Execution/AZT302/AZT302-2/","title":"AZT302.3 - Unmanaged Scripting: Automation Account RunAs Account","text":"<p>By utilizing an Automation Account configured with a RunAs account, an attacker can execute commands on an Azure VM via RunCommand (AZT301.1) if that service principal has the correct role and privileges.  </p> <p>Resource</p> <p>Automation Account</p> <p>Actions</p> <ul> <li>Microsoft.Automation/automationAccounts/runbooks/*</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>New-AzAutomationRunbook</code></p> <p><code>az automation runbook create</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/runbooks/{runbookName}?api-version=2019-06-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/automation/automation-runbook-execution</p>"},{"location":"Execution/AZT302/AZT302-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create an Azure Automation job Microsoft.Automation/automationAccounts/jobs/write Azure Activity Log Resource Publish an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/publish/action Azure Activity Log Resource Write an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/draft/write Azure Activity Log Resource Create or Update an Azure Automation Runbook Microsoft.Automation/automationAccounts/runbooks/write Azure Activity Log"},{"location":"Execution/AZT302/AZT302-2/#queries","title":"Queries","text":"Log Analytics <pre><code>|where OperationNameValue==\"Microsoft.Automation/automationAccounts/jobs/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/publish/action\"\n or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/draft/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/write\"\n</code></pre>"},{"location":"Execution/AZT302/AZT302-3/","title":"AZT302.3 - Unmanaged Scripting: Automation Account Managed Identity Account","text":"<p>By utilizing an Automation Account configured with a Managed Identity, an attacker can execute commands on an Azure VM via RunCommand (AZT301.1) if that service principal has the correct role and privileges. </p> <p>Resource</p> <p>Automation Account</p> <p>Actions</p> <ul> <li>Microsoft.Automation/automationAccounts/runbooks/*</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>New-AzAutomationRunbook</code></p> <p><code>az automation runbook create</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/runbooks/{runbookName}?api-version=2019-06-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/automation/automation-runbook-execution</p>"},{"location":"Execution/AZT302/AZT302-3/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create an Azure Automation job Microsoft.Automation/automationAccounts/jobs/write Azure Activity Log Resource Publish an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/publish/action Azure Activity Log Resource Write an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/draft/write Azure Activity Log Resource Create or Update an Azure Automation Runbook Microsoft.Automation/automationAccounts/runbooks/write Azure Activity Log"},{"location":"Execution/AZT302/AZT302-3/#queries","title":"Queries","text":"Log Analytics <pre><code>|where OperationNameValue==\"Microsoft.Automation/automationAccounts/jobs/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/publish/action\"\n or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/draft/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/write\"\n</code></pre>"},{"location":"Execution/AZT302/AZT302-4/","title":"AZT302.4 - Unmanaged Scripting: Function Application","text":"<p>By utilizing a Function Application, an attacker can execute Azure operations on a given resource.</p> <p>Resource</p> <p>Automation Account</p> <p>Actions</p> <ul> <li>Microsoft.Web/sites/hostruntime/vfs/run.csx/write</li> <li>Microsoft.Web/sites/functions/write</li> <li>Microsoft.Web/sites/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Update-AzFunctionApp</code></p> <p><code>az functionapp update</code></p> <p><code>GET https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Web/sites/{name}/functions?api-version=2021-02-01</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/azure-functions/functions-get-started?pivots=programming-language-powershell</p>"},{"location":"Execution/AZT302/AZT302-4/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Write Run.csx Microsoft.Web/sites/hostruntime/vfs/run.csx/write Azure Activity Log Resource Update Web Apps Functions Microsoft.Web/sites/functions/write Azure Activity Log Resource Update website Microsoft.Web/sites/write Azure Activity Log"},{"location":"Execution/AZT302/AZT302-4/#queries","title":"Queries","text":"Log Analytics <pre><code> |where OperationNameValue==\"Microsoft.Web/sites/hostruntime/vfs/run.csx/write\" or OperationNameValue==\"Microsoft.Web/sites/functions/write\"\nor OperationNameValue==\"Microsoft.Web/sites/write\"\n</code></pre>"},{"location":"Execution/AZT302/AZT302/","title":"AZT302 - Unmanaged Scripting","text":"<p>Adversaries may abuse access to serverless resources that are able to execute PowerShell or Python scripts on an Azure resource.</p> ID Name Description Action Resources AZT302.1 Automation Account Hybrid Worker Group By utilizing an Automation Account configured with a Hybrid Worker Group, an attacker can execute Azure commands on any Azure VM within that Hybrid Worker Group. Microsoft.Automation/automationAccounts/runbooks/* Automation Account AZT302.2 Automation Account Runbook RunAs Account By utilizing an Automation Account configured with a RunAs account, an attacker can execute commands on an Azure VM via RunCommand (AZT301.1) if that service principal has the correct role and privileges. Microsoft.Automation/automationAccounts/runbooks/* Automation Account AZT302.3 Automation Account Runbook Managed Identity By utilizing an Automation Account configured with a Managed Identity, an attacker can execute commands on an Azure VM via RunCommand (AZT301.1) if that service principal has the correct role and privileges. Microsoft.Automation/automationAccounts/runbooks/* Automation Account AZT302.4 Function Application By utilizing a Function Application, an attacker can execute Azure operations on a given resource. Microsoft.Web/sites/hostruntime/host/action Function App"},{"location":"Execution/AZT303/AZT303/","title":"AZT303 - Managed Device Scripting","text":"<p>Adversaries may abuse access to any managed devices in AzureAD by executing PowerShell or Python scripts on them.</p> <p>Resource</p> <p>Azure Active Directory Intune</p> <p>Actions</p> <ul> <li>microsoft.directory/devices/basic/update</li> </ul> <p>Examples</p> Microsoft Azure Graph APIAzure Portal <p><code>POST https://graph.microsoft.com/beta/deviceManagement/deviceManagementScripts</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/mem/intune/apps/intune-management-extension</li> <li>https://docs.microsoft.com/en-us/graph/api/resources/intune-graph-overview?view=graph-rest-beta</li> </ul>"},{"location":"Execution/AZT303/AZT303/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location InTune Write Run.csx Microsoft.Web/sites/hostruntime/vfs/run.csx/write Tenant Admin Audit Logs InTune Update Web Apps Functions Microsoft.Web/sites/functions/write Tenant Admin Audit Logs InTune Update website Microsoft.Web/sites/write Tenant Admin Audit Logs"},{"location":"Exfiltration/Exfiltration/","title":"Exfiltration","text":"<p>The adversary is trying to steal data. Exfiltration in Azure consists of using techniques to lift resource data from specific resources. This can be done by generating SAS URIs for unauthenticated &amp; persistent downloads, or can be done by directly exfiltrating the data from the resource itself.</p> ID Name Description AZT701 SAS URI Generation By generating an SAS URI for a resource, an adversary may extract the contents of that resource without authentication at any time. .001 VM Disk SAS URI An adversary may create an SAS URI to download the disk attached to a virtual machine. .002 Storage Account File Share SAS By generating a Shared Access Signature (SAS) URI, an adversary can access a container in a Storage Account at any time. AZT702 File Share Mounting An adversary may attach an Azure resource as a file share .001 Storage Account File Share NFS/SMB Mount An adversary can generate a connection string to mount an Azure Storage Account File Share as an NFS or SMB share to their local machine. AZT703 Replication An adversary may exfiltrate data by replicating it. .001 Storage Account Replication By setting up cross-tenant replication, an adversary may set up replication from one tenant's storage account to an extrenal tenant's storage account. AZT704 Soft-Delete Recovery An adversary may leverage resources found at a 'soft deletion' state, restore them and advance their attack by retrieving contents meant to be deleted .001 Key Vault An adversary may recover a key vault object found in a 'soft deletion' state. .002 Storage Blob An adversary may recover a storage blob found in a 'soft deletion' state. .003 Virtual Machine An adversary may recover a virtual machine found in a 'soft deletion' state."},{"location":"Exfiltration/AZT701/AZT701-1/","title":"AZT701.1 - SAS URI Generation: VM Disk SAS URI","text":"<p>An adversary may create an SAS URI to download the disk attached to a virtual machine.</p> <p>Resource</p> <p>Virutal Machine Disk</p> <p>Actions</p> <ul> <li>Microsoft.Compute/disks/beginGetAccess/action</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure Portal <ul> <li> <p><code>New-AzureStorageBlobSASToken</code></p> </li> <li> <p><code>New-AzStorageContainerSASToken</code></p> </li> </ul> <p><code>az storage blob generate-sas</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/marketplace/azure-vm-get-sas-uri</p>"},{"location":"Exfiltration/AZT701/AZT701-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Get Disk SAS URI Microsoft.Compute/disks/BeginGetAccess/action Azure Activity Log"},{"location":"Exfiltration/AZT701/AZT701-1/#queries","title":"Queries","text":"Log Analytics <pre><code>|where OperationNameValue==\"Microsoft.Compute/disks/BeginGetAccess/action\"\n</code></pre>"},{"location":"Exfiltration/AZT701/AZT701-2/","title":"AZT701.2 - SAS URI Generation: Storage Account File Share SAS","text":"<p>By generating a Shared Access Signature (SAS) URI, an adversary can access a container in a Storage Account at any time.</p> <p>Resource</p> <p>Azure Storage Account</p> <p>Actions</p> <ul> <li>Microsoft.Storage/storageAccounts/listAccountSas/action</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure Portal <ul> <li> <p><code>New-AzureStorageBlobSASToken</code></p> </li> <li> <p><code>New-AzStorageContainerSASToken</code></p> </li> </ul> <p><code>az storage blob generate-sas</code></p> <p></p> <p>Detections</p> <p>No logs are created when creating a SAS URI in an Azure Storage Account.</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview</p>"},{"location":"Exfiltration/AZT701/AZT701/","title":"AZT701 - SAS URI Generation","text":"<p>By generating an SAS URI for a resource, an adversary may extract the contents of that resource without authentication at any time.</p> ID Name Description Action Resources AZT701.1 VM Disk SAS URI An adversary may create an SAS URI to download a VM disk attached to a virtual machine. Microsoft.Compute/disks/beginGetAccess/action Virtual Machine Disk AZT701.2 Storage Account File Share SAS By generating a Shared Access Signature (SAS) URI, an adversary can access a container in a Storage Account at any time. Microsoft.Storage/storageAccounts/listAccountSas/action Azure Storage Account"},{"location":"Exfiltration/AZT702/AZT702-1/","title":"AZT702.1 - File Share Mounting: Storage Account File Share NFS/SMB Mount","text":"<p>An adversary can generate a connection string to mount an Azure Storage Account File Share as an NFS or SMB share to their local machine.</p> <p>Resource</p> <p>Azure Storage Account</p> <p>Actions</p> <ul> <li>Microsoft.Storage/storageAccounts/fileServices/shares/write</li> </ul> <p>Examples</p> Azure Portal <p></p> <p>Detections</p> <p>Connection logs to the share are not generated in Azure.</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/storage/files/files-smb-protocol?tabs=azure-portal</p>"},{"location":"Exfiltration/AZT703/AZT703-1/","title":"AZT703.1 - Replication: Storage Account Replication","text":"<p>By setting up cross-tenant replication, an adversary may set up replication from one tenant's storage account to an external tenant's storage account.</p> <p>Resource</p> <p>Azure Storage Account</p> <p>Actions</p> <ul> <li>Microsoft.Storage/storageAccounts/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure Portal <p><code>New-AzStorageObjectReplicationPolicyRule</code></p> <p><code>az storage account or-policy rule add</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/storage/blobs/object-replication-configure?tabs=portal</li> <li>https://docs.microsoft.com/en-us/azure/storage/blobs/object-replication-prevent-cross-tenant-policies?tabs=portal</li> </ul>"},{"location":"Exfiltration/AZT703/AZT703-1/#detection-details","title":"Detection Details","text":"<p>A policy can be created to alert when replication is set up.</p>"},{"location":"Exfiltration/AZT703/AZT703-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Put Object Replication Policy Microsoft.Storage/storageAccounts/objectReplicationPolicies/write Azure Activity Log"},{"location":"Exfiltration/AZT703/AZT703-1/#queries","title":"Queries","text":"<pre><code> |where OperationNameValue==\"Microsoft.Storage/storageAccounts/objectReplicationPolicies/write\"\n</code></pre>"},{"location":"Exfiltration/AZT704/AZT704-1/","title":"AZT704.1 - Soft-Delete Recovery: Key Vault","text":"<p>An adversary may recover a key vault object found in a 'soft deletion' state.</p> <p>Resource</p> <p>Azure Key Vault</p> <p>Actions</p> <ul> <li> <p>Microsoft.KeyVault/vaults/*/restore</p> </li> <li> <p>Microsoft.KeyVault/locations/deletedVaults/read   </p> </li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure Portal <ul> <li> <p><code>Undo-AzKeyVaultRemoval</code></p> </li> <li> <p><code>Undo-AzKeyVaultSecretRemoval</code></p> </li> <li> <p><code>Undo-AzKeyVaultKeyRemoval</code></p> </li> <li> <p><code>Undo-AzKeyVaultCertificateRemoval</code></p> </li> </ul> <ul> <li> <p><code>az keyvault certificate recover</code></p> </li> <li> <p><code>az keyvault key recover</code></p> </li> <li> <p><code>az keyvault secret recover</code></p> </li> <li> <p><code>az keyvault recover</code></p> </li> </ul> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/key-vault/general/soft-delete-overview</li> </ul>"},{"location":"Exfiltration/AZT704/AZT704-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource TBD TBD Log Analytics"},{"location":"Exfiltration/AZT704/AZT704-2/","title":"AZT704.2 - Soft-Delete Recovery: Storage Account Object","text":"<p>An adversary may recover a storage account object found in a 'soft deletion' state.</p> <p>Resource</p> <p>Azure Storage Account</p> <p>Actions</p> <ul> <li>Microsoft.Storage/storageAccounts/blobServices/\\/</li> </ul> <p>Examples</p> Azure REST APIAzure Portal <ul> <li> <p><code>Invoke-RESTMethod -Uri https://myaccount.blob.core.windows.net/mycontainer/myblob?comp=undelete -Method PUT</code></p> </li> <li> <p><code>Invoke-RESTMethod -Uri https://myaccount.blob.core.windows.net/destinationcontainer?restype=container&amp;comp=undelete -Method PUT</code></p> </li> </ul> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/storage/blobs/soft-delete-blob-overview</li> </ul>"},{"location":"Exfiltration/AZT704/AZT704-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource RestoreContainer TBD Log Analytics"},{"location":"Exfiltration/AZT704/AZT704-2/#queries","title":"Queries","text":"Log Analytics <p><code>StorageBlobLogs | where OperationName == 'RestoreContainer'</code></p>"},{"location":"Exfiltration/AZT704/AZT704-3/","title":"AZT704.1 - Soft-Delete Recovery: Recovery Services Vault","text":"<p>An adversary may recover a virtual machine object found in a 'soft deletion' state.</p> <p>Resource</p> <p>Azure Recovery Services Vault</p> <p>Actions</p> <ul> <li>Microsoft.RecoveryServices/Vaults/backupconfig/write</li> </ul> <p>Examples</p> Az PowerShellAzure REST APIAzure Portal <p><code>Undo-AzRecoveryServicesBackupItemDeletion</code></p> <p><code>Invoke-RESTMethod -body $body -Method PUT -Uri 'https://management.azure.com/Subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testVaultRG/providers/Microsoft.RecoveryServices/vaults/testVault/backupFabrics/Azure/protectionContainers/iaasvmcontainer;iaasvmcontainerv2;testRG;testVM/protectedItems/vm;iaasvmcontainerv2;testRG;testVM?api-version=2019-05-13'</code></p> <p><code>$Body ={\"properties\": {\"protectedItemType\": \"Microsoft.Compute/virtualMachines\",\"protectionState\": \"ProtectionStopped\",\"sourceResourceId\": \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testRG/providers/Microsoft.Compute/virtualMachines/testVM\",\"isRehydrate\": true}}</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/powershell/module/az.recoveryservices/undo-azrecoveryservicesbackupitemdeletion?view=azps-8.2.0</li> </ul>"},{"location":"Exfiltration/AZT704/AZT704-3/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource TBD TBD Log Analytics"},{"location":"Exfiltration/AZT704/AZT704/","title":"AZT704 - Soft-Delete Recovery","text":"<p>An adversary may leverage resources found at a 'soft deletion' state, restore them and advance their attack by retrieving contents meant to be deleted</p> ID Name Description Action Resources AZT704.1 Key Vault An adversary may recover a key vault object found in a 'soft deletion' state. Microsoft.KeyVault/vaults//restore Key Vault AZT704.2 Storage Account Object An adversary may recover a storage account object found in a 'soft deletion' state. Microsoft.Storage/storageAccounts/blobServices/\\/ Azure Storage Account AZT704.3 Recovery Services Vault An adversary may recover a virtual machine object found in a 'soft deletion' state. Microsoft.RecoveryServices/Vaults/backupconfig/write Azure Recovery Services Vault"},{"location":"InitialAccess/InitialAccess/","title":"Initial Access","text":"<p>The adversary is attempting to gain access to an Azure Resource or Azure AD.</p> ID Name Description AZT201 Valid Credentials Adversaries may login to AzureAD using valid credentials. .001 User Account By obtaining valid user credentials, an adversary may login to AzureAD via command line or through the Azure Portal. .002 Service Principal By obtaining a valid secret or certificate, an adversary may login to AzureAD via command line. AZT202 Password Spraying An adversary may potentially gain access to AzureAD by guessing a common password for multiple users. AZT203 Malicious Application Consent An adversary may lure a victim into giving their access to a malicious application registered in AzureAD."},{"location":"InitialAccess/AZT201/AZT201-1/","title":"AZT201.1 - User Account","text":"<p>By obtaining valid user credentials, an adversary may login to AzureAD via command line or through the Azure Portal. </p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <p>N/A</p> <p>Examples</p> Az PowerShell (Secret)Azure CLI <p><code>Connect-AzAccount</code></p> <p><code>az login -u &lt;username&gt; -p &lt;password&gt;</code></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-sign-ins</li> </ul>"},{"location":"InitialAccess/AZT201/AZT201-1/#logs","title":"Logs","text":"Data Source Application Resource Log Location Azure Active Directory Azure Portal Windows Azure Service Management API Sign-in Logs Azure Active Directory Microsoft Azure PowerShell Windows Azure Service Management API Sign-in Logs"},{"location":"InitialAccess/AZT201/AZT201-1/#queries","title":"Queries","text":"Log Analytics <p><code>SigninLogs|where Status ==\"{\\\"errorCode\\\":0}\" and ResourceDisplayName==\"Windows Azure Service Management API\"</code></p>"},{"location":"InitialAccess/AZT201/AZT201-1/#detection-screenshots","title":"Detection Screenshots","text":"Portal Sign-inPowerShell Sign-in"},{"location":"InitialAccess/AZT201/AZT201-2/","title":"AZT201.2 - Service Principal","text":"<p>By obtaining a valid secret or certificate, an adversary may login to AzureAD via command line.</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <p>N/A</p> <p>Examples</p> Az PowerShell (Secret)Az PowerShell (Certificate)Azure CLI <pre><code>$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $ApplicationId, $SecurePassword\nConnect-AzAccount -Credential $Credential -Tenant '$Context.Tenant.Id' -ServicePrincipal\n</code></pre> <pre><code>$import = Import-PfxCertificate -FilePath $CertPath -CertStoreLocation Cert:\\LocalMachine\\My -Password $SecurePassword -Exportable\nConnect-AzAccount -CertificateThumbprint \"$thumbprint\" -ApplicationId \"$appID\" -Tenant \"$tenant\"\n</code></pre> <pre><code>az login --service-principal -u &lt;app-id&gt; -p &lt;password-or-cert&gt; --tenant &lt;tenant&gt;\n</code></pre> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/powershell/module/az.accounts/connect-azaccount?view=azps-8.0.0</li> <li>https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-sign-ins</li> <li>https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli#sign-in-with-a-service-principal</li> </ul>"},{"location":"InitialAccess/AZT201/AZT201-2/#logs","title":"Logs","text":"Data Source Application Resource Log Location Azure Active Directory {Service Principal's Application ID} Windows Azure Service Management API Sign-in Logs"},{"location":"InitialAccess/AZT201/AZT201-2/#queries","title":"Queries","text":"Log Analytics <p><code>SigninLogs|where Status ==\"{\\\"errorCode\\\":0}\" and ResourceDisplayName==\"Windows Azure Service Management API\"</code></p>"},{"location":"InitialAccess/AZT201/AZT201-2/#detection-screenshots","title":"Detection Screenshots","text":""},{"location":"InitialAccess/AZT201/AZT201/","title":"AZT201 - Valid Credentials","text":"<p>Adversaries may login to AzureAD using valid credentials. By logging in with valid credentials to an account or service principal, the adversary will assume all privileges of that account or service principal. If the account is privileged, this may lead to other tactics, such as persistence or privilege escalation.</p> ID Name Description Action Resources AZT201.1 User Account By obtaining valid user credentials, an adversary may login to AzureAD via command line or through the Azure Portal. N/A AzureAD AZT201.2 Service Principal By obtaining a valid secret or certificate, an adversary may login to AzureAD via command line. N/A AzureAD"},{"location":"InitialAccess/AZT202/AZT202/","title":"AZT202 - Password Spraying","text":"<p>An adversary may potentially gain access to AzureAD by guessing a common password for multiple users.</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <p>N/A</p> <p>Examples</p> Az PowerShell (Secret)Azure CLI <p><code>Connect-AzAccount</code></p> <p><code>az login -u &lt;username&gt; -p &lt;password&gt;</code></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-sign-ins</li> <li>https://docs.microsoft.com/en-us/security/compass/incident-response-playbook-password-spray</li> <li>https://docs.microsoft.com/en-us/graph/api/resources/azure-ad-auditlog-overview?view=graph-rest-1.0</li> </ul>"},{"location":"InitialAccess/AZT202/AZT202/#logs","title":"Logs","text":"Data Source Application Resource Log Location Azure Active Directory Azure Portal Windows Azure Service Management API Sign-in Logs Azure Active Directory Microsoft Azure PowerShell Windows Azure Service Management API Sign-in Logs"},{"location":"InitialAccess/AZT202/AZT202/#detection-screenshots","title":"Detection Screenshots","text":""},{"location":"InitialAccess/AZT202/AZT202/#detection-notes","title":"Detection Notes","text":"<p>The main difference between a successful and unsuccessful login is the 'Status' field, which will designate a \"Success\" or \"Failure\". </p>"},{"location":"InitialAccess/AZT203/AZT203/","title":"AZT203 - Malicious Application Consent","text":"<p>An adversary may lure a victim into giving their access to a malicious application registered in AzureAD.</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <p>Any user can consent to an application which will impersonate that user's privileges.</p> <p>Examples</p> <p>N/A</p> <p>Detections</p> <p>Additional Resources</p> <ul> <li> <p>https://docs.microsoft.com/en-us/security/compass/incident-response-playbook-compromised-malicious-app</p> </li> <li> <p>https://docs.microsoft.com/en-us/security/compass/incident-response-playbook-app-consent</p> </li> </ul>"},{"location":"InitialAccess/AZT203/AZT203/#logs","title":"Logs","text":"Data Source Application Resource Log Location Azure Active Directory N/A AAD Log Analytics"},{"location":"InitialAccess/AZT203/AZT203/#queries","title":"Queries","text":"Log Analytics <p><code>AuditLogs| where ActivityDisplayName == \"Consent to application\"</code></p>"},{"location":"InitialAccess/AZT203/AZT203/#detection-details","title":"Detection Details","text":"<p>Please review the incident response playbooks in the 'Additional Resources' section below.</p>"},{"location":"Persistence/Persistence/","title":"Persistence","text":"<p>The adversary is trying to persist in the Azure tenant or subscription. Persistence consists of techniques that adversaries use to modify existing resources, or modify and manipulate accounts in order to access Azure Active Directory. </p> ID Name Description AZT501 Account Manipulation An adverary may manipulate an account to maintain access in an Azure tenant AZT501.1 User Account Manipulation An adverary may manipulate a user account to maintain access in an Azure tenant AZT501.2 Service Principal  Manipulation An adverary may manipulate a service principal to maintain access in an Azure tenant AZT501.3 Azure VM Local Administrator Manipulation An adverary may manipulate the local admin account on an Azure VM AZT502 Account Creation An adversary may create an account in Azure Active Directory. AZT502.1 User Account Creation An adversary may create a user account in Azure Active Directory. AZT502.2 Service Principal Creation An adversary may create an application &amp; service principal in Azure Active Directory AZT502.3 Guest Account Creation An adversary may create a guest account in Azure Active Directory AZT503 HTTP Trigger Adversaries may configure a resource with an HTTP trigger to run commands without needing authentication. AZT503.1 Logic Application HTTP Trigger Adversaries may configure a Logic Application with an HTTP trigger to run commands without needing authentication. AZT503.2 Function App HTTP Trigger Adversaries may configure a Function App with an HTTP trigger to run commands without needing authentication. AZT503.3 Runbook Webhook Adversaries may create a webhook to a Runbook which allows unauthenticated access into an Azure subscription or tenant. AZT503.4 WebJob Adversaries may create a WebJob on a App Service which allows arbitrary background tasks to be run on a set schedule AZT504 Watcher Tasks By configurating a watcher task and a Runbook, an adversary can establish persistence by executing the Runbook on a triggered event. AZT505 Scheduled Jobs By configurating an Azure resource that supports scheduled execution, an adversary can execute an operation at a defined interval. AZT505.1 Runbook Schedules Adversaries may create a schedule for a Runbook to run at a defined interval. AZT506 Network Security Group Modification Adversaries can modify the rules in a Network Security Group to establish access over additional ports. AZT507 External Entity Access Adversaries may configure the target Azure tenant to be managed by another, externel tenant, or its users. AZT507.1 Azure Lighthouse Adversaries may utilize Azure Lighthouse to manage the target tenant from an external tenant. AZT507.2 Microsoft Partners Adversaries may use Delegated Administrative Privileges to give themselves administrator access to the target tenant. AZT507.3 Subscription Hijack An adversary may transfer a subscription from a target tenant to an attacker-controlled tenant. AZT507.4 Domain Trust Modification An adversary may add an additional identity provider or domain to maintain a backdoor into the tenant. AZT508 Azure Policy By configuring a policy with the 'DeployIfNotExists' definition, an adverary may establish persistence by creating a backdoor when the policy is triggered. AZT509 Azure Bastion Azure Bastion can be abused to allow persistent network access to a virtual machine over public internet."},{"location":"Persistence/AZT501/AZT501-1/","title":"AZT501.1 - Account Manipulation: User Account Manipulation","text":"<p>An adverary may manipulate a user account to maintain access in an Azure tenant</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.directory/users/password/update</li> <li>microsoft.directory/users/enable</li> <li>microsoft.directory/users/restore</li> </ul> <p>Examples</p> Az PowerShellAzure CLIMicrosoft Graph APIAzure Portal <p><code>Update-AzADUser</code></p> <p><code>az ad user update</code></p> <p><code>PATCH https://graph.microsoft.com/v1.0/users/{id}</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-users-reset-password-azure-portal</p>"},{"location":"Persistence/AZT501/AZT501-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Active Directory Reset password microsoft.directory/users/password/update AzureAD Audit Logs Azure Active Directory Enable account microsoft.directory/users/enable AzureAD Audit Logs Azure Active Directory Update user microsoft.directory/users/password/update AzureAD Audit Logs"},{"location":"Persistence/AZT501/AZT501-1/#queries","title":"Queries","text":"Log Analytics <pre><code>AuditLogs \n|where OperationName ==\"Reset password\" or OperationName ==\"Enable account\" or OperationName ==\"Update user\"\n</code></pre>"},{"location":"Persistence/AZT501/AZT501-2/","title":"AZT501.2 - Account Manipulation: Service Principal Manipulation","text":"<p>An adverary may manipulate a service principal to maintain access in an Azure tenant</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.directory/servicePrincipals/enable</li> <li>microsoft.directory/servicePrincipals/credentials/update</li> <li>microsoft.directory/servicePrincipals/owners/update</li> </ul> <p>Examples</p> Az PowerShellAzure CLIMicrosoft Graph APIAzure Portal <p><code>Update-AzADServicePrincipal</code></p> <p><code>az ad sp update</code></p> <p><code>PATCH https://graph.microsoft.com/v1.0/servicePrincipals/{id}</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/active-directory/develop/app-objects-and-service-principals</p>"},{"location":"Persistence/AZT501/AZT501-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Active Directory Update application \u2013 Certificates and secrets management microsoft.directory/servicePrincipals/credentials/update AzureAD Audit Logs Azure Active Directory Update service principal microsoft.directory/servicePrincipals/credentials/update AzureAD Audit Logs Azure Active Directory Update user microsoft.directory/users/password/update AzureAD Audit Logs"},{"location":"Persistence/AZT501/AZT501-2/#queries","title":"Queries","text":"Log Analytics <pre><code>|where OperationName ==\"Update application \u2013 Certificates and secrets management\" or OperationName ==\"Update service principal\" or OperationName ==\"Update user\"\n</code></pre>"},{"location":"Persistence/AZT501/AZT501-3/","title":"AZT501.3 - Account Manipulation: Azure VM Local Administrator Manipulation","text":"<p>An adverary may manipulate the local admin account on an Azure VM</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.compute/virtualMachines/extensions/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Set-AzVMAccessExtension</code></p> <p><code>az vm extension set</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Compute/virtualMachines/{vmName}/extensions/{vmExtensionName}?api-version=2022-03-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/troubleshoot/azure/virtual-machines/reset-rdp</p>"},{"location":"Persistence/AZT501/AZT501-3/#detection-details","title":"Detection Details","text":"<p>After a successful reset, the log 'Validate Deployment' will be created. Specifically, in the scope, a password reset will be mentioned \"VMAccessWindowsPasswordReset\".</p>"},{"location":"Persistence/AZT501/AZT501-3/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create or Udpate Virutal Machine Extension microsoft.compute/virtualMachines/extensions/write Azure Activity Log Resource Validate Deployment Microsoft.Resources/deployments/validate/action Azure Activity Log"},{"location":"Persistence/AZT501/AZT501-3/#queries","title":"Queries","text":"Log Analytics <pre><code>AzureActivity \n|where OperationNameValue==\"microsoft.compute/virtualMachines/extensions/write\" or OperationNameValue==\"Microsoft.Resources/deployments/validate/action\"\n</code></pre>"},{"location":"Persistence/AZT501/AZT501-3/#detection-screenshot","title":"Detection Screenshot","text":""},{"location":"Persistence/AZT501/AZT501/","title":"AZT501 - Account Manipulation","text":"<p>An adverary may manipulate an account to maintain access in an Azure tenant</p> ID Name Description Action Resources AZT501.1 User Account Manipulation An adverary may manipulate a user account to maintain access in an Azure tenant microsoft.directory/users/password/update Azure Active Directory microsoft.directory/users/enable microsoft.directory/users/restore AZT501.2 Service Principal  Manipulation An adverary may manipulate a service principal to maintain access in an Azure tenant microsoft.directory/servicePrincipals/enable Azure Active Directory microsoft.directory/servicePrincipals/credentials/update microsoft.directory/servicePrincipals/owners/update AZT501.3 Azure VM Local Administrator Manipulation An adverary may manipulate the local admin account on an Azure VM microsoft.compute/virtualMachines/extensions/write Azure Virtual Machine"},{"location":"Persistence/AZT502/AZT502-1/","title":"AZT502.1 - Account Creation: User Account Creation","text":"<p>An adversary may create an application &amp; service principal in Azure Active Directory</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.directory/users/create</li> </ul> <p>Examples</p> Az PowerShellAzure CLIMicrosoft Graph APIAzure Portal <p><code>New-AzADUser</code></p> <p><code>az ad user create</code></p> <p><code>POST https://graph.microsoft.com/v1.0/users</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-users-reset-password-azure-portal</p>"},{"location":"Persistence/AZT502/AZT502-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Active Directory Add user microsoft.directory/users/create AzureAD Audit Logs"},{"location":"Persistence/AZT502/AZT502-1/#queries","title":"Queries","text":"Log Analytics <p><code>AuditLogs| where ActivityDisplayName == \"Add user\"</code></p>"},{"location":"Persistence/AZT502/AZT502-2/","title":"AZT502.2 - Account Creation: Service Principal Creation","text":"<p>An adversary may create an application &amp; service principal in Azure Active Directory</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.directory/servicePrincipals/create</li> <li>microsoft.directory/applications/create</li> </ul> <p>Examples</p> Az PowerShellAzure CLIMicrosoft Graph APIAzure Portal <p><code>New-AzADServicePrincipal</code></p> <p><code>az ad sp create</code></p> <p><code>POST https://graph.microsoft.com/v1.0/servicePrincipals</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/active-directory/develop/app-objects-and-service-principals</p>"},{"location":"Persistence/AZT502/AZT502-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Active Directory Add service principal microsoft.directory/servicePrincipals/create AzureAD Audit Logs Azure Active Directory Add application microsoft.directory/applications/create AzureAD Audit Logs Azure Active Directory Add owner to application microsoft.directory/servicePrincipals/owners/update AzureAD Audit Logs"},{"location":"Persistence/AZT502/AZT502-2/#queries","title":"Queries","text":"Log Analytics <pre><code>AuditLogs \n|where OperationName ==\"Add service principal\" or OperationName ==\"Add application\" or OperationName ==\"Add owner to application\"\n</code></pre>"},{"location":"Persistence/AZT502/AZT502-3/","title":"AZT502.1 - Account Creation: Guest Account Creation","text":"<p>An adversary may create a guest account in Azure Active Directory  </p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.directory/users/create</li> <li>microsoft.directory/users/inviteGuest</li> </ul> <p>Examples</p> Azure Portal <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/active-directory/external-identities/b2b-quickstart-add-guest-users-portal</p>"},{"location":"Persistence/AZT502/AZT502-3/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Active Directory Invited Users microsoft.directory/users/inviteGuest AzureAD Audit Logs"},{"location":"Persistence/AZT502/AZT502-3/#queries","title":"Queries","text":"Log Analytics <p><code>AuditLogs| where ActivityDisplayName == \"Invited Users\"</code></p>"},{"location":"Persistence/AZT502/AZT502/","title":"AZT502 - Account Creation","text":"<p>An adversary may create an account in Azure Active Directory.</p> ID Name Description Action Resources AZT502.1 User Account Creation An adversary may create a user account in Azure Active Directory. microsoft.directory/users/create Azure Active Directory AZT502.2 Service Principal Creation An adversary may create an application &amp; service principal in Azure Active Directory microsoft.directory/servicePrincipals/create Azure Active Directory microsoft.directory/applications/create AZT502.3 Guest Account Creation An adversary may create a guest account in Azure Active Directory microsoft.directory/servicePrincipals/create Azure Active Directory"},{"location":"Persistence/AZT503/AZT503-1/","title":"AZT503.1 - HTTP Trigger: Logic Application HTTP Trigger","text":"<p>Adversaries may configure a Logic Application with a user account or managed identity and modify the HTTP trigger to run a command via HTTP request.</p> <p>Resource</p> <p>Logic Application</p> <p>Actions</p> <ul> <li>Microsoft.Logic/workflows/write</li> <li>Microsoft.Logic/workflows/run/action</li> <li>Microsoft.Logic/operations/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Set-AzLogicApp</code></p> <p><code>az logicapp start</code> </p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}?api-version=2016-06-01</code> </p> <p> </p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/logic-apps/logic-apps-overview</p>"},{"location":"Persistence/AZT503/AZT503-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Gets workflow recommend operation groups Microsoft.Logic/locations/workflows/recommendOperationGroups/action Azure Activity Log Resource List Trigger Callback URL Microsoft.Logic/workflows/triggers/listCallbackUrl/action Azure Activity Log Resource Add or Update Connection Microsoft.Web/connections/write Azure Activity Log"},{"location":"Persistence/AZT503/AZT503-1/#queries","title":"Queries","text":"Log Analytics <pre><code>|where OperationNameValue==\"Microsoft.Logic/locations/workflows/recommendOperationGroups/action\" or OperationNameValue==\"Microsoft.Logic/workflows/triggers/listCallbackUrl/action\"orOperationNameValue==\"Microsoft.Web/connections/write\"\n</code></pre>"},{"location":"Persistence/AZT503/AZT503-2/","title":"AZT503.2 - HTTP Trigger: Function App HTTP Trigger","text":"<p>Adversaries may configure a Function Application with a user account or managed identity and modify the HTTP trigger to run a command via HTTP request.</p> <p>Resource</p> <p>Function App</p> <p>Actions</p> <ul> <li>Microsoft.Web/sites/Write</li> <li>Microsoft.web/sites/functions/action</li> <li>Microsoft.web/sites/functions/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLI <p><code>Update-AzFunctionApp</code></p> <p><code>az functionapp update</code></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview</p>"},{"location":"Persistence/AZT503/AZT503-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Active Directory Update website Microsoft.Web/sites/write AzureAD Audit Logs Azure Active Directory Start Web App Microsoft.Web/sites/start/action AzureAD Audit Logs"},{"location":"Persistence/AZT503/AZT503-2/#queries","title":"Queries","text":"Log Analytics <p><code>AuditLogs| where ActivityDisplayName == \"Update website\" or ActivityDisplayName == \"Start Web App\"</code></p>"},{"location":"Persistence/AZT503/AZT503-3/","title":"AZT503.3 - HTTP Trigger: Runbook Webhook","text":"<p>Adversaries may create a webhook to a Runbook which allows unauthenticated access into an Azure subscription or tenant.</p> <p>Resource</p> <p>Automation Accounts</p> <p>Actions</p> <ul> <li>Microsoft.Automation/automationAccounts/runbooks/*</li> <li>Microsoft.Automation/automationAccounts/webhooks/write</li> </ul> <p>Examples</p> Az PowerShellAzure REST APIAzure Portal <p><code>New-AzAutomationWebhook</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/webhooks/{webhookName}?api-version=2015-10-31</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/automation/automation-webhooks?tabs=portal</li> <li>https://www.netspi.com/blog/technical/cloud-penetration-testing/maintaining-azure-persistence-via-automation-accounts/</li> </ul>"},{"location":"Persistence/AZT503/AZT503-3/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create or Update an Azure Automation webhook Microsoft.Automation/automationAccounts/webhooks/write Azure Activity Log"},{"location":"Persistence/AZT503/AZT503-4/","title":"AZT503.4 - HTTP Trigger: WebJob","text":"<p>Adversaries may create a WebJob on a App Service which allows arbitrary background tasks to be run on a set schedule</p> <p>Resource</p> <p>App Service</p> <p>Actions</p> <ul> <li>Microsoft.Web/sites/Write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Start-AzWebAppTriggeredWebJob</code></p> <p><code>az webapp webjob triggered</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Web/sites/{name}/triggeredwebjobs/{webJobName}/run?api-version=2021-02-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://github.com/Azure/azure-webjobs-sdk/wiki#documentation</li> <li>https://docs.microsoft.com/en-us/azure/app-service/webjobs-create</li> </ul>"},{"location":"Persistence/AZT503/AZT503-4/#detection-details","title":"Detection Details","text":"<p>To enable logging on AppServices, a Diagnostic setting must be enabled to send logs to an aggregator. In addition, App Service Logs should be enabled.</p> <p>WebJob output logs can be viewed on the web application in the format: https://{WEBAPPNAME}.scm.azurewebsites.net/azurejobs/#/jobs/</p>"},{"location":"Persistence/AZT503/AZT503-4/#detection-screenshot","title":"Detection Screenshot","text":"Web Job LogsApplication Logs"},{"location":"Persistence/AZT503/AZT503/","title":"AZT503 - HTTP Trigger","text":"<p>Adversaries may configure a resource with an HTTP trigger to run commands without needing authentication.</p> ID Name Description Action Resources AZT503.1 Logic Application Adversaries may configure a Logic Application with an HTTP trigger to run commands without needing authentication. Microsoft.Logic/workflows/write Logic Application Microsoft.Logic/workflows/run/action Microsoft.Logic/operations/read AZT503.2 Function App Adversaries may configure a Function App with an HTTP trigger to run commands without needing authentication. Microsoft.Web/sites/Write Function App microsoft.web/sites/functions/action microsoft.web/sites/functions/write AZT503.3 Runbook Webhook Adversaries may create a webhook to a Runbook which allows unauthenticated access into an Azure subscription or tenant. Microsoft.Automation/automationAccounts/runbooks/* Automation Account AZT503.4 WebJob Adversaries may create a WebJob on a App Service which allows arbitrary background tasks to be run on a set schedule Microsoft.Web/sites/Write App Service"},{"location":"Persistence/AZT504/AZT504/","title":"AZT504 - Watcher Tasks","text":"<p>By configurating a watcher task and a Runbook, an adversary can establish persistence by executing the Runbook on a triggered event.</p> <p>Resource</p> <p>Automation Account</p> <p>Actions</p> <ul> <li>Microsoft.Automation/automationAccounts/runbooks/*</li> </ul> <p>Examples</p> Az PowerShellAzure REST APIAzure Portal <p><code>New-AzAutomationWebhook</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/webhooks/{webhookName}?api-version=2015-10-31</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/automation/automation-scenario-using-watcher-task</p>"},{"location":"Persistence/AZT504/AZT504/#detection-details","title":"Detection Details","text":"<p>No logs are generated when a watcher task is created.</p>"},{"location":"Persistence/AZT504/AZT504/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create an Azure Automation job Microsoft.Automation/automationAccounts/jobs/write Azure Activity Log Resource Publish an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/publish/action Azure Activity Log Resource Write an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/draft/write Azure Activity Log Resource Create or Update an Azure Automation Runbook Microsoft.Automation/automationAccounts/runbooks/write Azure Activity Log"},{"location":"Persistence/AZT504/AZT504/#queries","title":"Queries","text":"Log Analytics <pre><code>|where OperationNameValue==\"Microsoft.Automation/automationAccounts/jobs/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/publish/action\"\n or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/draft/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/write\"\n</code></pre>"},{"location":"Persistence/AZT505/AZT505-1/","title":"AZT505.1 - Scheduled Jobs - Runbook Schedules","text":"<p>Adversaries may create a schedule for a Runbook to run at a defined interval.</p> <p>Resource</p> <p>Automation Account</p> <p>Actions</p> <ul> <li>Microsoft.Automation/automationAccounts/Schedules/write</li> </ul> <p>Examples</p> Az PowerShellAzure REST APIAzure Portal <p><code>New-AzAutomationSchedule</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/jobSchedules/{jobScheduleId}?api-version=2019-06-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/automation/shared-resources/schedules</p>"},{"location":"Persistence/AZT505/AZT505-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create or Update an Azure Automation schedule asset Microsoft.Automation/automationAccounts/Schedules/write Azure Activity Log"},{"location":"Persistence/AZT505/AZT505-1/#queries","title":"Queries","text":"Log Analytics <pre><code>        |where OperationNameValue==\"Microsoft.Automation/automationAccounts/Schedules/write\"\n</code></pre>"},{"location":"Persistence/AZT506/AZT506/","title":"AZT506 - Network Security Group Modification","text":"<p>Adversaries can modify the rules in a Network Security Group to establish access over additional ports.</p> <p>Resource</p> <p>Network Security Group</p> <p>Actions</p> <ul> <li>Microsoft.Network/networkSecurityGroups/*</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Set-AzNetworkSecurityRuleConfig</code></p> <p><code>az network nsg rule</code> </p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/networkSecurityGroups/{networkSecurityGroupName}/securityRules/{securityRuleName}?api-version=2021-08-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/virtual-network/manage-network-security-group</p>"},{"location":"Persistence/AZT506/AZT506/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create or Update Security Rule Microsoft.Network/networkSecurityGroups/securityRules/write Azure Activity Log"},{"location":"Persistence/AZT506/AZT506/#queries","title":"Queries","text":"Log Analytics <pre><code>      |where OperationNameValue==\"Microsoft.Network/networkSecurityGroups/securityRules/write\"\n</code></pre>"},{"location":"Persistence/AZT507/AZT507-1/","title":"AZT507.1 - Azure Lighthouse","text":"<p>Adversaries may utilize Azure Lighthouse to manage the target tenant from an external tenant</p> <p>Resource</p> <p>AzureAD</p> <p>Actions</p> <ul> <li>Microsoft.ManagedServices/registrationAssignments/Write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>New-AzSubscriptionDeployment</code></p> <p><code>az deployment sub create</code> </p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/networkSecurityGroups/{networkSecurityGroupName}/securityRules/{securityRuleName}?api-version=2021-08-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/lighthouse/how-to/onboard-customer</p>"},{"location":"Persistence/AZT507/AZT507-1/#detection-details","title":"Detection Details","text":"<ul> <li>The Az PowerShell cmdlets <code>Get-AzManagedServicesDefinition</code> and <code>Get-AzManagedServicesAssignment</code>, or az cli cmdlets <code>az managedservices definition list</code> and <code>az managedservices assignment list</code> can be used to list the onboarded customers to the tenant.</li> </ul>"},{"location":"Persistence/AZT507/AZT507-2/","title":"AZT507.2 - Microsoft Partners","text":"<p>Adversaries may use Delegated Administrative Privileges to give themselves administrator access to the target tenant.</p> <p>Resource</p> <p>AzureAD</p> <p>Actions</p> <ul> <li>N/A</li> </ul> <p>Examples</p> <ul> <li>N/A</li> </ul> <p>Detections</p> <p>Additional Resources</p> <ul> <li> <p>https://docs.microsoft.com/en-us/microsoft-365/commerce/manage-partners?view=o365-worldwide</p> </li> <li> <p>https://o365blog.com/post/partners/</p> </li> </ul>"},{"location":"Persistence/AZT507/AZT507-2/#detection-details","title":"Detection Details","text":"<p>By reviewing access logs in AzureAD, a key indicator is identifying logins from users that do not contain a domain linked to the tenant. </p>"},{"location":"Persistence/AZT507/AZT507-3/","title":"AZT507.3 - Subscription Hijack","text":"<p>An adversary may transfer a subscription from a target tenant to an attacker-controlled tenant. This retains the billing account setup by the target and the target tenant administrators will no longer have control over the subscription.</p> <p>Resource</p> <p>Azure Subscription</p> <p>Actions</p> <p>The \"Owner\" role is needed to complete the transfer.</p> <p>Examples</p> Azure Portal <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li> <p>https://docs.microsoft.com/en-us/azure/role-based-access-control/transfer-subscription</p> </li> <li> <p>https://derkvanderwoude.medium.com/azure-subscription-hijacking-and-cryptomining-86c2ac018983</p> </li> </ul>"},{"location":"Persistence/AZT507/AZT507-3/#detection-details","title":"Detection Details","text":"<ul> <li> <p>A policy can be placed on the subscription to prevent transfers. https://docs.microsoft.com/en-us/azure/cost-management-billing/manage/manage-azure-subscription-policy</p> </li> <li> <p>The logs for the subscription are transfered with the subscription    </p> </li> </ul>"},{"location":"Persistence/AZT507/AZT507-4/","title":"AZT507.3 - Domain Trust Modification","text":"<p>An adversary may add an additional identity provider or domain to maintain a backdoor into the tenant.</p> <p>Resource</p> <p>AzureAD</p> <p>Actions</p> <ul> <li>N/A</li> </ul> <p>Examples</p> <p>Detections</p> <p>Additional Resources</p> <ul> <li> <p>https://o365blog.com/post/aadbackdoor/</p> </li> <li> <p>https://www.mandiant.com/resources/detecting-microsoft-365-azure-active-directory-backdoors</p> </li> <li> <p>https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/Defense%20evasion/ADFSDomainTrustMods%5BNobelium%5D.yaml</p> </li> </ul>"},{"location":"Persistence/AZT507/AZT507-4/#detection-details","title":"Detection Details","text":"<p>Monitor the 'Pass-through Authentication' page in the Azure portal. Azure AD Connect &gt; Pass-through Authentication</p>"},{"location":"Persistence/AZT507/AZT507/","title":"AZT507 - External Entity Access","text":"<p>Adversaries may configure the target Azure tenant to be managed by another, externel tenant, or its users.</p> ID Name Description Action Resources AZT507.1 Azure Lighthouse Adversaries may utilize Azure Lighthouse to manage the target tenant from an external tenant. Microsoft.ManagedServices/registrationAssignments/Write AzureAD AZT507.2 Microsoft Partners Adversaries may use Delegated Administrative Privileges to give themselves administrator access to the target tenant. N/A AzureAD AZT507.3 Subscription Hijack An adversary may transfer a subscription from a target tenant to an attacker-controlled tenant. N/A Azure Subscription AZT507.4 Domain Trust Modification An adversary may add an additional identity provider or domain to maintain a backdoor into the tenant. N/A AzureAD"},{"location":"Persistence/AZT508/AZT508/","title":"AZT508 - Azure Policy","text":"<p>By configuring a policy with the 'DeployIfNotExists' definition, an adverary may establish persistence by creating a backdoor when the policy is triggered.</p> <p>Resource</p> <p>Azure Policy</p> <p>Actions</p> <ul> <li> <p>Microsoft.Authorization/policies/deployIfNotExists/action</p> </li> <li> <p>Microsoft.Authorization/policyAssignments/write</p> </li> </ul> <p>Examples</p> Azure Portal <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/governance/policy/concepts/effects#deployifnotexists</p>"},{"location":"Persistence/AZT508/AZT508/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource 'deployIfNotExists' Policy Action Microsoft.Authorization/policies/deployIfNotExists/action Activity Log Resource N/A Microsoft.Authorization/policyAssignments/write Activity Log"},{"location":"Persistence/AZT508/AZT508/#queries","title":"Queries","text":"Log Analytics <pre><code>      |where OperationNameValue==\"Microsoft.Authorization/policies/deployIfNotExists/action\" or OperationNameValue==\"Microsoft.Authorization/policyAssignments/write\"\n</code></pre>"},{"location":"Persistence/AZT509/AZT509/","title":"AZT509 - Azure Bastion","text":"<p>Azure Bastion can be abused to allow persistent network access to a virtual machine over public internet.</p> <p>Resource</p> <p>Azure Bastion</p> <p>Actions</p> <ul> <li> <p>Microsoft.Network/bastionHosts/write</p> </li> <li> <p>Microsoft.Network/bastionHosts/createShareableLinks/action</p> </li> <li> <p>Microsoft.Network/bastionHosts/getShareableLinks/action</p> </li> </ul> <p>Detections</p> <p>Additional Resources</p> <p>https://blog.karims.cloud/2022/11/26/yet-another-azure-vm-persistence.html</p>"},{"location":"Persistence/AZT509/AZT509/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Get Bastion Shareable Link Microsoft.Network/bastionHosts/GetShareableLinks/action Activity Log Resource N/A Microsoft.Network/bastionHosts/write Azure Activity Log"},{"location":"Persistence/AZT509/AZT509/#queries","title":"Queries","text":"Log Analytics <pre><code>    | where OperationNameValue =~ \"MICROSOFT.NETWORK/BASTIONHOSTS/GETSHAREABLELINKS/ACTION\" or OperationNameValue =~ \"MICROSOFT.NETWORK/BASTIONHOSTS/CREATESHAREABLELINKS/ACTION\"\n    | order by TimeGenerated desc\n    | project Caller, CallerIpAddress, OperationName, TimeGenerated, ResourceId\n</code></pre>"},{"location":"PrivilegeEscalation/PrivEsc/","title":"Privilige Escalation","text":"<p>The adversary is trying to escalate their privileges within Azure Resources or Azure Active Directory.</p> ID Name Description AZT401 Privileged Identity Management Role An adversary may escalate their privileges if their current account has access to Privileged Identity Management (PIM) AZT402 Elevated Access Toggle An adversary may escalate their privileges from Azure AD to all Azure subscriptions in the tenant if they are a global administrator AZT403 Local Resource Hijack An adversary may escalate their privileges by tampering with a local file generated by a resource .001 Cloud Shell .IMG By modifying the .bashrc file in a CloudShell .IMG file, an adversary may escalate their privileges AZT404 Principal Impersonation Adversaries may abuse resources that are configured with a service principal or other identity to further their access to the current or other resources. .001 Function Application By utilizing a Function Application configured with a managed identity or other identity provider, an attacker can execute Azure operations on a given resource. .002 Logic Application By utilizing a Logic Application configured with a managed identity or other identity provider, an attacker can execute Azure operations on a given resource. .003 Automation Account By utilizing a Automation Account configured with a managed identity or RunAs account, an attacker can execute Azure operations on a given resource. .004 App Service By utilizing an App Service configured with a managed identity or other identity provider, an attacker can execute Azure operations on a given resource. AZT405 Azure AD Application Adversaries may abuse the assigned permissions on an Azure AD Application to escalate their privileges. .001 Application API Permissions By compromising a service principal whose application has privileged API permissions, an attacker can escalate their privileges to a higher privileged role. .002 Application Role By compromising a user, user in a group, or service principal that has an application role over an application, they may be able to escalate their privileges by impersonating the associated service principal and leveraging any privileged assigned application role. .003 Application Registration Owner By compromising an account who is an 'Owner' over an application that is configured with additional roles or API permissions, an attacker can escalate their privileges by adding a certificate or credentials &amp; logging in as the service principal."},{"location":"PrivilegeEscalation/AZT401/AZT401/","title":"AZT401 - Privileged Identity Management Role","text":"<p>An adversary may escalate their privileges if their current account is eligible for role activation via Privileged Identity Management (PIM).</p> <p>Resource</p> <ul> <li>Azure Active Directory</li> <li>Azure Resources</li> </ul> <p>Actions</p> <ul> <li>RoleManagement.ReadWrite.Directory</li> <li>RoleManagement.Read.Directory</li> </ul> <p>Examples</p> AzureAD PowerShellMicrosoft Azure Graph APIAzure REST APIAzure Portal <p><code>Open-AzureADMSPrivilegedRoleAssignmentRequest</code></p> <p><code>GET https://graph.microsoft.com/beta/roleManagement/directory/roleEligibilitySchedules/313af44a-07c9-43a7-9970-5072a6b5591f</code></p> <p><code>GET https://management.azure.com/{scope}/providers/Microsoft.Authorization/roleEligibilityScheduleRequests/{roleEligibilityScheduleRequestName}?api-version=2020-10-01</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-configure</li> <li>https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/powershell-for-azure-ad-roles</li> <li>https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-apis</li> </ul>"},{"location":"PrivilegeEscalation/AZT401/AZT401/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Active Directory Add member to role requested (PIM activation) RoleManagement.ReadWrite.Directory PIM Audit Logs Azure Active Directory Add member to role completed (PIM activation) RoleManagement.ReadWrite.Directory PIM Audit Logs Azure Active Directory Add eligible member to role in PIM completed (permanent) RoleManagement.ReadWrite.Directory PIM Audit Logs Azure Active Directory Add eligible member to role in PIM requested (permanent) RoleManagement.ReadWrite.Directory PIM Audit Logs"},{"location":"PrivilegeEscalation/AZT401/AZT401/#detection-screenshots","title":"Detection Screenshots","text":""},{"location":"PrivilegeEscalation/AZT402/AZT402/","title":"AZT402 - Elevated Access Toggle","text":"<p>An adversary may escalate their privileges from Azure AD to all Azure subscriptions in the tenant if they are a global administrator</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>Microsoft.Authorization/elevateAccess/action</li> </ul> <p>Examples</p> Azure CLIAzure REST APIAzure Portal <p><code>az rest --method post --url \"/providers/Microsoft.Authorization/elevateAccess?api-version=2016-07-01\"</code></p> <p><code>POST https://management.azure.com/providers/Microsoft.Authorization/elevateAccess?api-version=2016-07-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin</p>"},{"location":"PrivilegeEscalation/AZT402/AZT402/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Azure Active Directory Assigns the caller to User Access Administrator role Microsoft.Authorization/elevateAccess/action AzureAD Audit Logs"},{"location":"PrivilegeEscalation/AZT402/AZT402/#queries","title":"Queries","text":"Log Analytics <pre><code>| where ActivityDisplayName == \"Assigns the caller to User Access Administrator role\"\n</code></pre>"},{"location":"PrivilegeEscalation/AZT402/AZT402/#detection-screenshots","title":"Detection Screenshots","text":""},{"location":"PrivilegeEscalation/AZT403/AZT403-1/","title":"AZT403.1 - Local Resource Hijack: Cloud Shell .IMG","text":"<p>By modifying the .bashrc file in a CloudShell .IMG file, an adversary may escalate their privileges by injecting commands that will add an arbitrary user account to a desired role and scope.</p> <p>Resource</p> <p>Azure CloudShell</p> <p>Actions</p> <ul> <li>n/a</li> </ul> <p>Examples</p> Azure Portal <p></p> <p>Detections</p> <p>Additional Resources</p> <ul> <li>https://docs.microsoft.com/en-us/azure/cloud-shell/overview</li> <li>https://www.netspi.com/blog/technical/cloud-penetration-testing/attacking-azure-cloud-shell/</li> </ul>"},{"location":"PrivilegeEscalation/AZT403/AZT403-1/#detection-details","title":"Detection Details","text":"<p>A storage account is created in order to store the profile .IMG file when using CloudShell. These storage accounts always start with <code>cs</code> followed by a string of numbers + letters. E.g.: <code>cs120000000ff</code> Logs from the storage account require them to be configured with diagnostic settings being sent to a log aggregator. </p> <p>Additionally, <code>~/.config/PowerShell/Microsoft.PowerShell_profile.ps1</code> is where the PowerShell startup script is stored, which also may be a target for backdooring. </p>"},{"location":"PrivilegeEscalation/AZT404/AZT404-1/","title":"AZT404.1 - Principal Impersonation: Function Application","text":"<p>By utilizing a Function Application configured with a managed identity or other identity provider, an attacker can execute Azure operations on a given resource.</p> <p>Resource</p> <p>Function Application</p> <p>Actions</p> <ul> <li>Microsoft.Web/sites/hostruntime/vfs/run.csx/write</li> <li>Microsoft.Web/sites/functions/write</li> <li>Microsoft.Web/sites/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Update-AzFunctionApp</code></p> <p><code>az functionapp update</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Web/sites/{name}?api-version=2021-02-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/app-service/overview-managed-identity?tabs=ps%2Cdotnet</p>"},{"location":"PrivilegeEscalation/AZT404/AZT404-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Write Run.csx Microsoft.Web/sites/hostruntime/vfs/run.csx/write Azure Activity Log Resource Update Web Apps Functions Microsoft.Web/sites/functions/write Azure Activity Log Resource Update website Microsoft.Web/sites/write Azure Activity Log"},{"location":"PrivilegeEscalation/AZT404/AZT404-1/#queries","title":"Queries","text":"Log Analytics <pre><code>AzureActivity \n|where OperationNameValue==\"Microsoft.Web/sites/hostruntime/vfs/run.csx/write\" or OperationNameValue==\"Microsoft.Web/sites/functions/write\"\nor OperationNameValue==\"Microsoft.Web/sites/write\"\n</code></pre>"},{"location":"PrivilegeEscalation/AZT404/AZT404-2/","title":"AZT404.2 - Principal Impersonation: Logic Application","text":"<p>By utilizing a Logic Application configured with a managed identity or other identity provider, an attacker can execute Azure operations on a given resource.</p> <p>Resource</p> <p>Logic Application</p> <p>Actions</p> <ul> <li>Microsoft.Logic/workflows/write</li> <li>Microsoft.Logic/workflows/run/action</li> <li>Microsoft.Logic/operations/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Set-AzLogicApp</code></p> <p><code>az logicapp start</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}?api-version=2016-06-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/logic-apps/logic-apps-overview</p>"},{"location":"PrivilegeEscalation/AZT404/AZT404-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Gets workflow recommend operation groups Microsoft.Logic/locations/workflows/recommendOperationGroups/action Azure Activity Log Resource List Trigger Callback URL Microsoft.Logic/workflows/triggers/listCallbackUrl/action Azure Activity Log Resource Add or Update Connection Microsoft.Web/connections/write Azure Activity Log Azure Active Directory Update website Microsoft.Web/sites/write AzureAD Audit Logs Azure Active Directory Start Web App Microsoft.Web/sites/start/action AzureAD Audit Logs"},{"location":"PrivilegeEscalation/AZT404/AZT404-2/#queries","title":"Queries","text":"Log Analytics <pre><code>AzureActivity \n |where OperationNameValue==\"Microsoft.Logic/locations/workflows/recommendOperationGroups/action\" or OperationNameValue==\"Microsoft.Logic/workflows/triggers/listCallbackUrl/action\"\nor OperationNameValue==\"Microsoft.Web/connections/write\" or OperationNameValue==\"Microsoft.Web/sites/write\" or OperationNameValue==\"Microsoft.Web/sites/start/action\"\n</code></pre>"},{"location":"PrivilegeEscalation/AZT404/AZT404-3/","title":"AZT404.3 - Unmanaged Scripting: Automation Account Runbook","text":"<p>By utilizing a Automation Account configured with a managed identity or RunAs account, an attacker can execute Azure operations on a given resource.</p> <p>Resource</p> <p>Automation Account</p> <p>Actions</p> <ul> <li>Microsoft.Automation/automationAccounts/runbooks/*    </li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>New-AzAutomationRunbook</code></p> <p><code>az automation runbook</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/runbooks/{runbookName}?api-version=2019-06-01</code></p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/automation/automation-runbook-execution</p>"},{"location":"PrivilegeEscalation/AZT404/AZT404-3/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Create an Azure Automation job Microsoft.Automation/automationAccounts/jobs/write Azure Activity Log Resource Publish an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/publish/action Azure Activity Log Resource Write an Azure Automation runbook draft Microsoft.Automation/automationAccounts/runbooks/draft/write Azure Activity Log Resource Create or Update an Azure Automation Runbook Microsoft.Automation/automationAccounts/runbooks/write Azure Activity Log"},{"location":"PrivilegeEscalation/AZT404/AZT404-3/#queries","title":"Queries","text":"Log Analytics <pre><code>|where OperationNameValue==\"Microsoft.Automation/automationAccounts/jobs/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/publish/action\"\nor OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/draft/write\" or OperationNameValue==\"Microsoft.Automation/automationAccounts/runbooks/write\"\n</code></pre>"},{"location":"PrivilegeEscalation/AZT404/AZT404-4/","title":"AZT404.4 - Principal Impersonation: App Service","text":"<p>By utilizing an App Service configured with a managed identity or other identity provider, an attacker can execute Azure operations on a given resource.</p> <p>Resource</p> <p>App Service</p> <p>Actions</p> <ul> <li>Microsoft.Web/sites/write</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Update-AzStaticWebApp</code></p> <p><code>az staticwebapp update</code></p> <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Web/sites/{name}?api-version=2021-02-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/app-service/overview-managed-identity?tabs=portal%2Chttp</p>"},{"location":"PrivilegeEscalation/AZT404/AZT404-4/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location Resource Update website Microsoft.Web/sites/write Azure Activity Logs Resource Start Web App Microsoft.Web/sites/start/action Azure Activity Logs"},{"location":"PrivilegeEscalation/AZT404/AZT404-4/#queries","title":"Queries","text":"Log Analytics <pre><code>AzureActivity \n |where OperationNameValue==\"Microsoft.Web/sites/write\" or OperationNameValue==\"Microsoft.Web/sites/start/action\"\n</code></pre>"},{"location":"PrivilegeEscalation/AZT404/AZT404/","title":"AZT404 - Principal Impersonation","text":"<p>Adversaries may abuse resources that are configured with a service principal or other identity to further their access to the current or other resources.</p> ID Name Description Action Resources AZT404.1 Function Application By utilizing a Function Application configured with a managed identity or other identity provider, an attacker can execute Azure operations on a given resource. Microsoft.Web/sites/hostruntime/vfs/run.csx/write Function App Microsoft.Web/sites/functions/write Microsoft.Web/sites/write AZT404.2 Logic Application By utilizing a Logic Application configured with a managed identity or other identity provider, an attacker can execute Azure operations on a given resource. Microsoft.Logic/workflows/write Logic Application Microsoft.Logic/workflows/run/action Microsoft.Logic/operations/read AZT404.3 Automation Account By utilizing a Automation Account configured with a managed identity or RunAs account, an attacker can execute Azure operations on a given resource. Microsoft.Automation/automationAccounts/runbooks/* Automation Account AZT404.4 App Service By utilizing an App Service configured with a managed identity or other identity provider, an attacker can execute Azure operations on a given resource. Microsoft.Web/sites/write App Service"},{"location":"PrivilegeEscalation/AZT405/AZT405-1/","title":"AZT405.1 - Azure AD Application: Application Role","text":"<p>By compromising a user, user in a group, or service principal that has an application role over an application, they may be able to escalate their privileges by impersonating the associated service principal and leveraging any privileged assigned application role.</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <p>N/A</p> <p>Since the attacker controls the application, no actions are needed.</p> <p>Examples</p> Azure REST APIAzure Portal <p><code>GET https://graph.microsoft.com/v1.0/servicePrincipals?$filter=appId eq '00000002-0000-0000-c000-000000000000'</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/graph/migrate-azure-ad-graph-configure-permissions</p>"},{"location":"PrivilegeEscalation/AZT405/AZT405-1/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location N/A N/A N/A N/A"},{"location":"PrivilegeEscalation/AZT405/AZT405-2/","title":"AZT405.2 - Azure AD Application: Application API Permissions","text":"<p>By compromising a service principal whose application has privileged API permissions, an attacker can escalate their privileges to a higher privileged role. </p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <p>N/A</p> <p>Since the attacker controls the application, no actions are needed.</p> <p>Examples</p> Azure REST APIAzure Portal <p><code>PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Web/sites/{name}?api-version=2021-02-01</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/app-service/overview-managed-identity?tabs=portal%2Chttp</p>"},{"location":"PrivilegeEscalation/AZT405/AZT405-2/#logs","title":"Logs","text":"Data Source Operation Name Action Log Location N/A N/A N/A N/A"},{"location":"PrivilegeEscalation/AZT405/AZT405-3/","title":"AZT405.3 - Azure AD Application: Application Registration Owner","text":"<p>By compromising an account who is an 'Owner' over an application that is configured with additional roles or API permissions, an attacker can escalate their privileges by adding a certificate or credentials &amp; logging in as the service principal. </p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.directory/servicePrincipals/credentials/update</li> </ul> <p>Examples</p> Azure PowerShellaz cliAzure REST APIAzure Portal <p><code>New-AzADSpCredential -ServicePrincipalName ServicePrincipalName</code></p> <p><code>az ad sp credential reset</code></p> <p><code>POST /servicePrincipals/{id}/addKey</code> </p> <p></p> <p>Detections</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/powershell/azure/create-azure-service-principal-azureps?view=azps-8.0.0#reset-credentials</p>"},{"location":"PrivilegeEscalation/AZT405/AZT405-3/#logs","title":"Logs","text":"Data Source Operation Name Category Log Location Azure AD Update application \u2013 Certificates and secrets management ApplicationManagement AzureAD Audit Logs"},{"location":"PrivilegeEscalation/AZT405/AZT405-3/#queries","title":"Queries","text":"Log Analytics <pre><code>AuditLogs \n|where OperationName ==\"Update application \u2013 Certificates and secrets management\" and Category==\"ApplicationManagement\"\n</code></pre>"},{"location":"PrivilegeEscalation/AZT405/AZT405/","title":"AZT405 - Azure AD Application","text":"<p>Adversaries may abuse the assigned permissions on an Azure AD Application to escalate their privileges.</p> ID Name Description Action Resources AZT405.1 Application Role By compromising a user, user in a group, or service principal that has an application role over an application, they may be able to escalate their privileges by impersonating the associated service principal and leveraging any privileged assigned application role. AzureAD AZT405.2 Application API Permissions By compromising a service principal whose application has privileged API permissions, an attacker can escalate their privileges to a higher privileged role. AzureAD AZT405.3 Application Registration Owner By compromising an account who is an 'Owner' over an application that is configured with additional roles or API permissions, an attacker can escalate their privileges by adding a certificate or credentials &amp; logging in as the service principal. AzureAD"},{"location":"Reconnaissance/Reconnaissance/","title":"Reconnaissance","text":"<p>The adversary is trying to gather information they can use to plan future operations.</p> <p>Reconnaissance consists of techniques that involve adversaries actively or passively gathering information that can be used to support targeting. Such information may include details of the victim organization, infrastructure, or staff/personnel. This information can be leveraged by the adversary to aid in other phases of the adversary lifecycle, such as using gathered information to plan and execute Initial Access, to scope and prioritize post-compromise objectives, or to drive and lead further Reconnaissance efforts.</p> ID Name Description AZT101 Port Mapping By viewing certain Azure resources, it is possible to view the open ports on a resource. AZT102 IP Discovery By viewing certain Azure resources, it is possible to view the private and public IP addresses assigned to a  resource. AZT103 Public Accessible Resource A resource within Azure is accessible from the public internet. AZT104 Gather User Information An adversary may obtain information about a user within Azure Active Directory. AZT105 Gather Application Information An adversary may obtain information about an application within Azure Active Directory. AZT106 Gather Role Information An adversary may obtain information about a role. .001 Gather AAD Role Information An adversary may obtain information about a role within Azure Active Directory. .002 Gather Application Role Information An adversary may obtain information about an application role within Azure Active Directory. .003 Gather Azure Resources Role Assignments An adversary may gather role assignments for a specific Azure Resource, Resource Group, or Subscription. AZT107 Gather Resource Data An adversary may obtain information and data within a resource. AZT108 Gather Victim Data An adversary may access a user's personal data if their account is compromised"},{"location":"Reconnaissance/AZT101/AZT101/","title":"AZT101 - Port Mapping","text":"<p>It is possible to view the open ports on a virtual machine by viewing the Virtual Network Interface's assigned Network Security Group</p> <p>Resource</p> <p>Network Security Group</p> <p>Actions</p> <ul> <li>Microsoft.Network/networkSecurityGroups/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Get-AzNetworkSecurityGroup</code></p> <p><code>az network nsg show</code></p> <p><code>GET https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/networkSecurityGroups/{networkSecurityGroupName}?api-version=2021-08-01</code></p> <p> </p> <p>Detections</p> <p>N/A</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview</p>"},{"location":"Reconnaissance/AZT102/AZT102/","title":"AZT102 - IP Discovery","text":"<p>It is possible to view the IP address on a resource by viewing the Virtual Network Interface</p> <p>Resource</p> <ul> <li>Network Interface</li> <li>Virtual Machine</li> </ul> <p>Actions</p> <ul> <li>Microsoft.Network/publicIPAddresses/read</li> <li>Microsoft.Compute/virtualMachines/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Get-AzPublicIpAddress</code></p> <p><code>az network public-ip show</code></p> <p><code>GET https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/publicIPAddresses/{publicIpAddressName}?api-version=2021-08-01</code></p> <p></p> <p>Detections</p> <p>N/A</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/virtual-network/ip-services/public-ip-addresses</p>"},{"location":"Reconnaissance/AZT103/AZT103/","title":"AZT103 - Public Accessible Resource","text":"<p>A resource within Azure is accessible from the public internet.</p> <p>Resource</p> <ul> <li>Network Interface</li> <li>Virtual Machine</li> </ul> <p>Actions</p> <p>n/a</p> <p>Examples</p> <p>N/A</p> <p>Detections</p> <p>N/A</p>"},{"location":"Reconnaissance/AZT104/AZT104/","title":"AZT104 - Gather User Information","text":"<p>An adversary may obtain information about a User within Azure Active Directory. Details may include email addresses, first/last names, job information, addresses, and assigned roles. By default, all users are able to read other user's roles and group memberships within AAD.</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.directory/*/*/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIMicrosoft Graph REST APIAzure Portal <p><code>Get-AzADUser</code></p> <p><code>az ad user show</code></p> <p><code>GET https://graph.microsoft.com/v1.0/users/{id | userPrincipalName}</code></p> <p></p> <p>Detections</p> <p>N/A</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions</p>"},{"location":"Reconnaissance/AZT105/AZT105/","title":"AZT105 - Gather Application Information","text":"<p>An adversary may obtain information about an application within Azure Active Directory.</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.directory/applications/*/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIMicrosoft Graph REST APIAzure Portal <p><code>Get-AzADApplication</code></p> <p><code>az ad app show</code></p> <p><code>GET https://graph.microsoft.com/v1.0/applications/{id}</code></p> <p></p> <p>Detections</p> <p>N/A</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/graph/migrate-azure-ad-graph-configure-permissions</p>"},{"location":"Reconnaissance/AZT106/AZ-T106-4/","title":"AZT106.4 - List Transitive Role Assignments","text":"<p>An adversary may gather Transitive Role Assignments by specifiying a known principal id</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <p>N/A</p> <p>Examples</p> Microsoft Graph REST API <ul> <li><code>GET https://graph.microsoft.com/v1.0/directoryRoles/{role ID}</code></li> </ul> <p>Detections</p> <p>N/A</p> <p>Additional Resources</p> <p>N/A</p>"},{"location":"Reconnaissance/AZT106/AZT106-1/","title":"AZT106.1 - Gather Role Information: Gather AzureAD Role Assignments","text":"<p>An adversary may gather role assignments within Azure Active Directory.</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.directory/roleAssignments/standard/read</li> <li>microsoft.directory/directoryRoles/standard/read</li> <li>microsoft.directory/directoryRoles/eligibleMembers/read</li> <li>microsoft.directory/directoryRoles/members/read</li> </ul> <p>Examples</p> Microsoft Graph REST APIAzure Portal <ul> <li><code>GET https://graph.microsoft.com/v1.0/directoryRoles/{role ID}</code></li> </ul> <p></p> <p>Detections</p> <p>N/A</p> <p>Additional Resources</p> <p>N/A</p>"},{"location":"Reconnaissance/AZT106/AZT106-2/","title":"AZT106.2 - Gather Role Information: Gather Application Role Assignments","text":"<p>An adversary may gather information about an application role &amp; it's member assignments within Azure Active Directory.</p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <ul> <li>microsoft.directory/roleAssignments/standard/read</li> <li>microsoft.directory/directoryRoles/standard/read</li> <li>microsoft.directory/directoryRoles/eligibleMembers/read</li> <li>microsoft.directory/directoryRoles/members/read</li> <li>microsoft.directory/users/appRoleAssignments/read</li> <li>microsoft.directory/servicePrincipals/appRoleAssignments/read</li> <li>microsoft.directory/servicePrincipals/appRoleAssignedTo/read</li> <li>microsoft.directory/applications/owners/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIMicrosoft Graph REST APIAzure Portal <p><code>Get-AzADAppPermission</code></p> <p><code>az ad app permission list</code></p> <ul> <li><code>GET https://graph.microsoft.com/v1.0/users/{id}/appRoleAssignments</code></li> <li><code>GET https://graph.microsoft.com/v1.0/servicePrincipals/{id}/appRoleAssignments</code> </li> <li><code>GET https://graph.microsoft.com/v1.0/groups/{id}/appRoleAssignments</code></li> </ul> <p></p> <p>Detections</p> <p>N/A</p> <p>Additional Resources</p> <p>https://docs.microsoft.com/en-us/azure/architecture/multitenant-identity/app-roles</p>"},{"location":"Reconnaissance/AZT106/AZT106-3/","title":"AZT106.3 - Gather Role Information: Gather Azure Resources Role Assignments","text":"<p>An adversary may gather role assignments for a specific Azure Resource, Resource Group, or Subscription.</p> <p>Resource</p> <p>Azure Resources</p> <p>Actions</p> <ul> <li>{resource}/read</li> </ul> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Get-AzRoleAssignment</code></p> <p><code>az role assignment</code></p> <ul> <li><code>GET https://management.azure.com/{scope}/providers/Microsoft.Authorization/roleAssignments?api-version=2015-07-01</code></li> </ul> <p></p> <p>Detections</p> <p>N/A</p> <p>Additional Resources</p> <p>N/A</p>"},{"location":"Reconnaissance/AZT106/AZT106/","title":"AZT106 - Gather Role Information","text":"<p>An adversary may obtain information about a role within Azure Active Directory or within Azure Resource Manager.</p> ID Name Description Action Resource AZT106.1 Gather Role Information An adversary may obtain information about a role within Azure Active Directory microsoft.directory/roleAssignments/standard/read Azure Active Directory microsoft.directory/directoryRoles/standard/read microsoft.directory/directoryRoles/eligibleMembers/read microsoft.directory/directoryRoles/members/read AZT106.2 Gather Application Role Information An adversary may obtain information about an application role within Azure Active Directory microsoft.directory/roleAssignments/standard/read Azure Active Directory microsoft.directory/directoryRoles/standard/read microsoft.directory/directoryRoles/eligibleMembers/read microsoft.directory/directoryRoles/members/read microsoft.directory/users/appRoleAssignments/read microsoft.directory/servicePrincipals/appRoleAssignments/read microsoft.directory/servicePrincipals/appRoleAssignedTo/read microsoft.directory/applications/owners/read AZT106.3 Gather Azure Resources Role Assignments An adversary may gather role assignments for a specific Azure Resource, Resource Group, or Subscription. {resource}/read Azure Resources AZT106.4 List Transitive Role Assignments An adversary may gather Transitive Role Assignments by specifiying a known principal Id Azure Active Directory"},{"location":"Reconnaissance/AZT107/AZT107/","title":"AZT107 - Gather Resource Data","text":"<p>An adversary may obtain information and data within a resource.</p> <p>Actions</p> <ul> <li>{resource}/*/read</li> </ul> <p>Resource</p> <p>Azure Resources</p> <p>Examples</p> Az PowerShellAzure CLIAzure REST APIAzure Portal <p><code>Get-AzResource</code></p> <p><code>az resource show</code></p> <p><code>GET https://management.azure.com/{resourceId}?api-version=2021-04-01</code></p> <p></p> <p>Detections</p> <p>N/A</p> <p>Additional Resources</p> <p>N/A</p>"},{"location":"Reconnaissance/AZT108/AZT108/","title":"AZT108 - Gather Victim Data","text":"<p>An adversary may access a user's personal data if their account is compromised. This includes data such as email, OneDrive, Teams, etc. </p> <p>Resource</p> <p>Azure Active Directory</p> <p>Actions</p> <p>N/A</p> <p>Examples</p> <p>N/A</p> <p>Detections</p> <p>N/A</p> <p>Additional Resources</p>"}]}